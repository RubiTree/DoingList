{"ast":null,"code":"import _slicedToArray from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject4(){var data=_taggedTemplateLiteral([\"\\nmargin: 2px;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  flex-grow: 1;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  background: #ffffff;\\n  display: flex;\\n  height: 100%;\\n  flex-direction: column;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect}from'react';import styled from'styled-components';import{Input,message,Switch,Button,Modal,DatePicker}from'antd';import stores from'../stores';import{Duration,TimeLine}from'../model/model';import Utils from'../utils/Utils';import DateUtils from'../utils/DateUtils';import TaskInfoFormat from'../utils/TaskInfoFormat';import Format from'../utils/Format';import{CurrentTaskKey}from'../stores/CurrentTaskStore';import'antd/dist/antd.css';import{CurrentDoingTaskKey}from'../stores/CurrentDoingTaskStore';import moment from'moment';var Container=styled.div(_templateObject());var Div=styled.div(_templateObject2());var Editor=styled(Input.TextArea)(_templateObject3());var ButtonGroup=styled(Button.Group)(_templateObject4());var ContentLayout=function ContentLayout(){var _ref=stores.useStore('mainmodel'),storeModel=_ref.storeModel;var _ref2=stores.useStore(CurrentTaskKey),currentTask=_ref2.currentTask;var _ref3=stores.useStore('mainmodel'),save=_ref3.save;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),content=_useState2[0],setContent=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),timeline=_useState4[0],setTimeline=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isExpectConsume=_useState6[0],setExpectConsumeUI=_useState6[1];var _useState7=useState(-1),_useState8=_slicedToArray(_useState7,2),expectTime=_useState8[0],setExpectTime=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isHaveDeadline=_useState10[0],setHaveDeadlineUI=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),deadline=_useState12[0],setDeadlineUI=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isPending=_useState14[0],setPendingUI=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),pendingReason=_useState16[0],setPendingReason=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),pendingTime=_useState18[0],setPendingTimeUI=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),expectStartTime=_useState20[0],setExpectStartTimeUI=_useState20[1];// toolsbar\nvar _ref4=stores.useStore(CurrentDoingTaskKey),currentDoingTask=_ref4.currentDoingTask,setCurrentDoingTask=_ref4.setCurrentDoingTask;/* ---------------------------初始化------------------------------- */ // 渲染当前note\nvar _useState21=useState(undefined),_useState22=_slicedToArray(_useState21,2),lastTask=_useState22[0],setLastTask=_useState22[1];useEffect(function(){// console.log(`Current content:${content}`)\nif(currentTask===undefined)return;if(!currentTask.isSameTask(lastTask)){// todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\nsetLastTask(currentTask);setContent(currentTask.note.content);// todo 这部分逻辑抽出去\nvar _expectTime=currentTask.getActualExpectConsume();if(_expectTime<0){setExpectTime(_expectTime);setExpectConsume(false);}else{setExpectConsume(true);setExpectTime(_expectTime/(3600*1000));}setPendingUI(currentTask.isPending());setPendingReason(currentTask.pendingReason);setPendingTimeUI(getPendingDeadlineTime(currentTask));setDeadlineUI(getDeadlineTime(currentTask));setHaveDeadline(currentTask.isHaveDeadline());if(currentTask!==undefined&&!currentTask.isStarted()){setExpectStartTimeUI(moment(currentTask.expectStartTime));}else{setExpectStartTimeUI(null);}storeModel.normalUpdate();}});/* ----------------------------保存Note文本------------------------------ */function _onBlur(event){event.preventDefault();saveToLocal(event,false);}function saveToLocal(event,isManual){if(event)event.preventDefault();if(currentTask===undefined)return;currentTask.note.content=content;save();if(isManual)message.info(\"已保存\");}/* ------------------------------toolsbar---------------------------- */function deleteTask(event){if(currentTask===undefined)return;Modal.confirm({title:'确定要删除吗？',content:\"\\u662F\\u5426\\u5220\\u9664\\u4EFB\\u52A1\\uFF1A\".concat(currentTask.title),onOk:function onOk(){if(storeModel.removeTask(currentTask)){message.success(\"删除任务成功\");save();}else{message.error(\"删除任务失败\");}}});}function doneTask(event){if(currentTask===undefined)return;var task=currentTask;if(task.isDone()){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u5B8C\\u6210\\uFF0C\\u5B8C\\u6210\\u65F6\\u95F4:\".concat(Format.formatTimeInMs(task.doneTime)));return;}if(!task.isDoing()){Modal.confirm({title:'当前任务不在进行中，确定要完成吗？',content:\"\\u662F\\u5426\\u5B8C\\u6210\\u4EFB\\u52A1\\uFF1A\".concat(task.title),onOk:function onOk(){_realDone(task);}});return;}task.stop();setCurrentDoingTask(undefined);_realDone(task);}function _realDone(task){task.done();storeModel.normalUpdate();message.success(\"任务已完成\");save();}function onChooseDeadline(value){if(currentTask===undefined)return;var task=currentTask;// 整了半天，原来直接 valueOf() 就行，百度了半天\n// if(value instanceof Moment){\n//   let moment:Moment = value\n//   console.log('onOk: ', moment.);\n// }\n// console.log('onOk: ', value.valueOf());\ntask.deadlines.push(value.valueOf());setDeadlineUI(getDeadlineTime(currentTask));save();}function getDeadlineTime(task){var deadline=task.getActualDeadline();if(deadline>0){return moment(deadline);}return null;}function getShowTips(){if(currentTask===undefined)return\"\";var task=currentTask;var result=TaskInfoFormat.getDoingStatusTips(task)+TaskInfoFormat.getConsumed(task)+TaskInfoFormat.getDeadline(task)+TaskInfoFormat.getConsumeExpected(task)+TaskInfoFormat.getStartExpected(task);return result;}function changeExceptTime(){if(currentTask===undefined)return;var task=currentTask;if(expectTime==-1){task.expectConsumes.push(-1);// todo 暂时不优化交互了，-1就是不设置时间\n}else{task.expectConsumes.push(expectTime*3600*1000);}save();}/* ---------------------------------------------------------- */function onChoosePendingDeadline(value){if(currentTask===undefined)return;var task=currentTask;if(!isPending){message.error(\"\\u8BBE\\u7F6E\\u65E0\\u6548\\uFF0C\\u8BF7\\u6253\\u5F00 pending \\u5F00\\u5173\\u540E\\u91CD\\u65B0\\u8BBE\\u7F6E\");return;}var pendingLine=value.valueOf();if(!isTimeValid(pendingLine,\"Pending时间\",Duration.create(undefined,task.getActualDeadline(),\"Deadline\"))){return;}task.pendingDeadline=pendingLine;setPendingTimeUI(getPendingDeadlineTime(task));save();}function onChangeExpectStartTime(value,task){var expectStartTime=value.valueOf();if(!isTimeValid(expectStartTime,\"预期开始时间\",Duration.create(undefined,task.pendingDeadline,\"PendLine\"),Duration.create(undefined,task.getActualDeadline(),\"Deadline\"))){return;}setExpectStartTimeUI(expectStartTime);task.expectStartTime=expectStartTime;save();}function isTimeValid(time,timeName){var isValid=true;for(var index=0;index<(arguments.length<=2?0:arguments.length-2);index++){var dur=index+2<2||arguments.length<=index+2?undefined:arguments[index+2];if(dur.start>0&&time<dur.start){message.error(\"\".concat(timeName,\"(\").concat(Format.formatTimeInMinute(time),\")\\u65E9\\u4E8E\").concat(dur.start,\"(\").concat(Format.formatTimeInMinute(dur.start),\")\\uFF0C\\u8BF7\\u91CD\\u65B0\\u8BBE\\u7F6E\"));isValid=false;}else if(dur.end>0&&time>dur.end){message.error(\"\".concat(timeName,\"(\").concat(Format.formatTimeInMinute(time),\")\\u665A\\u4E8E\").concat(dur.end,\"(\").concat(Format.formatTimeInMinute(dur.end),\")\\uFF0C\\u8BF7\\u91CD\\u65B0\\u8BBE\\u7F6E\"));isValid=false;}if(!isValid){return false;}}return true;}function getPendingDeadlineTime(task){var deadline=task.pendingDeadline;if(deadline>0){return moment(deadline);}return null;}function savePendingStatus(){if(currentTask===undefined)return;var task=currentTask;task.pendingReason=pendingReason;save();}function setPending(pendingStatus){if(currentTask===undefined)return;var task=currentTask;if(!pendingStatus){task.pendingDeadline=-1;setPendingTimeUI(null);save();}setPendingUI(pendingStatus);}function setExpectConsume(pendingStatus){if(currentTask===undefined)return;var task=currentTask;// 关闭就不估时并保存\nif(!pendingStatus){task.expectConsumes.push(-1);setExpectTime(-1);save();}setExpectConsumeUI(pendingStatus);}function setHaveDeadline(pendingStatus){if(currentTask===undefined)return;var task=currentTask;// 关闭就不估时并保存\nif(!pendingStatus){task.deadlines.push(-1);setDeadlineUI(null);save();}setHaveDeadlineUI(pendingStatus);}function onAddTimeline(event){event.preventDefault();if(currentTask===undefined)return;if(Utils.isStringEmpty(timeline)){message.error(\"请输入内容\");return;}var endTimeline=currentTask.note.endTimeLine();if(endTimeline==null||!DateUtils.isSameDay(endTimeline.timeStamp,Utils.getTimestamp())){currentTask.note.timeLines.push(TimeLine.createDivNode());}currentTask.note.timeLines.push(TimeLine.createContentNode(timeline));save();setTimeline(\"\");}/* ---------------------------------------------------------- */if(currentTask===undefined)return null;return/*#__PURE__*/React.createElement(Container,{style:{margin:\"5px\"}},currentTask!==undefined&&/*#__PURE__*/React.createElement(Div,{style:{margin:\"5px\"}},/*#__PURE__*/React.createElement(ButtonGroup,null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return deleteTask(e);}},\"D\"),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return doneTask(e);}},\"Done\")),/*#__PURE__*/React.createElement(Switch,{style:{marginLeft:'5px',marginRight:'3px'},checkedChildren:\"\\u4F30\\u65F6\",unCheckedChildren:\"\\u4E0D\\u9650\",checked:isExpectConsume,onChange:function onChange(event){return setExpectConsume(event);}}),/*#__PURE__*/React.createElement(Switch,{style:{marginLeft:'5px',marginRight:'3px'},checkedChildren:\"\\u622A\\u6B62\\u65F6\\u95F4\",unCheckedChildren:\"\\u6CA1\\u6709\\u622A\\u6B62\",checked:isHaveDeadline,onChange:function onChange(event){return setHaveDeadline(event);}}),/*#__PURE__*/React.createElement(Switch,{style:{marginLeft:'9px',marginRight:'5px'},checkedChildren:\"Pending\",unCheckedChildren:\"NoPend\",checked:isPending,onChange:function onChange(event){return setPending(event);}})),/*#__PURE__*/React.createElement(\"div\",{style:{marginLeft:\"15px\",marginRight:\"15px\",fontWeight:\"bold\"}},getShowTips()),/*#__PURE__*/React.createElement(Div,{style:{marginTop:\"5px\",marginBottom:\"5px\"}},expectStartTime!==null&&/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"15px\"}},\"\\u9884\\u671F\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\",/*#__PURE__*/React.createElement(DatePicker,{showTime:true,value:expectStartTime,onOk:function onOk(value){return onChangeExpectStartTime(value,currentTask);}})),isExpectConsume&&/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"15px\"}},\"\\u4F30\\u65F6\\uFF1A\",/*#__PURE__*/React.createElement(Input,{style:{width:'100px'},value:expectTime,placeholder:\"\\u82B1\\u8D39\\u65F6\\u95F4 \\u56DE\\u8F66\\u4FDD\\u5B58\",prefix:\"\\u9884\\u8BA1\",suffix:\"h\",onChange:function onChange(event){return setExpectTime(Number(event.target.value));},onBlur:changeExceptTime})),isHaveDeadline&&/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"15px\"}},\"DeadLine\\uFF1A\",/*#__PURE__*/React.createElement(DatePicker,{showTime:true,value:deadline,onOk:function onOk(value){return onChooseDeadline(value);}})),isPending&&/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"15px\"}},\"Pending\\uFF1A\",/*#__PURE__*/React.createElement(DatePicker,{showTime:true,value:pendingTime,onOk:function onOk(value){return onChoosePendingDeadline(value);}}),/*#__PURE__*/React.createElement(Input,{style:{width:'200px'},value:pendingReason,prefix:\"\\u539F\\u56E0:\",placeholder:\"\\uFF08\\u81EA\\u52A8\\u4FDD\\u5B58\\uFF09\",onChange:function onChange(event){return setPendingReason(event.target.value);},onBlur:savePendingStatus}))),currentTask!==undefined&&/*#__PURE__*/React.createElement(Div,{style:{marginLeft:\"15px\"}},/*#__PURE__*/React.createElement(Input,{placeholder:\"\\u8F93\\u5165\\u65F6\\u95F4\\u7EBF\\uFF0C\\u56DE\\u8F66\\u6DFB\\u52A0\",value:timeline,onChange:function onChange(event){return setTimeline(event.target.value);},onPressEnter:onAddTimeline}),/*#__PURE__*/React.createElement(Div,{style:{height:\"250px\",overflow:\"scroll\",whiteSpace:\"pre-wrap\"}},currentTask.note.getFormartTimeLines())),/*#__PURE__*/React.createElement(Editor,{placeholder:\"\\u4EFB\\u52A1\\u65E5\\u5FD7\\uFF08\\u81EA\\u52A8\\u4FDD\\u5B58\\uFF09\",value:content,onChange:function onChange(event){return setContent(event.target.value);},onBlur:function onBlur(e){return _onBlur(e);}}));};export default ContentLayout;","map":{"version":3,"sources":["/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/ContentLayout.tsx"],"names":["React","useState","useEffect","styled","Input","message","Switch","Button","Modal","DatePicker","stores","Duration","TimeLine","Utils","DateUtils","TaskInfoFormat","Format","CurrentTaskKey","CurrentDoingTaskKey","moment","Container","div","Div","Editor","TextArea","ButtonGroup","Group","ContentLayout","useStore","storeModel","currentTask","save","content","setContent","timeline","setTimeline","isExpectConsume","setExpectConsumeUI","expectTime","setExpectTime","isHaveDeadline","setHaveDeadlineUI","deadline","setDeadlineUI","isPending","setPendingUI","pendingReason","setPendingReason","pendingTime","setPendingTimeUI","expectStartTime","setExpectStartTimeUI","currentDoingTask","setCurrentDoingTask","undefined","lastTask","setLastTask","isSameTask","note","getActualExpectConsume","setExpectConsume","getPendingDeadlineTime","getDeadlineTime","setHaveDeadline","isStarted","normalUpdate","onBlur","event","preventDefault","saveToLocal","isManual","info","deleteTask","confirm","title","onOk","removeTask","success","error","doneTask","task","isDone","formatTimeInMs","doneTime","isDoing","_realDone","stop","done","onChooseDeadline","value","deadlines","push","valueOf","getActualDeadline","getShowTips","result","getDoingStatusTips","getConsumed","getDeadline","getConsumeExpected","getStartExpected","changeExceptTime","expectConsumes","onChoosePendingDeadline","pendingLine","isTimeValid","create","pendingDeadline","onChangeExpectStartTime","time","timeName","isValid","index","dur","start","formatTimeInMinute","end","savePendingStatus","setPending","pendingStatus","onAddTimeline","isStringEmpty","endTimeline","endTimeLine","isSameDay","timeStamp","getTimestamp","timeLines","createDivNode","createContentNode","margin","e","marginLeft","marginRight","fontWeight","marginTop","marginBottom","width","Number","target","height","overflow","whiteSpace","getFormartTimeLines"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Switch, Button, List, Dropdown, Menu, Modal, DatePicker } from 'antd';\nimport stores from '../stores';\nimport { Task } from '../model/model'\nimport { StoreModel, Duration, TimeLine } from '../model/model'\nimport Utils from '../utils/Utils'\nimport DateUtils from '../utils/DateUtils'\nimport MomentUtils from '../utils/MomentUtils'\nimport TaskInfoFormat from '../utils/TaskInfoFormat'\nimport Format from '../utils/Format'\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport 'antd/dist/antd.css';\nimport { CurrentDoingTaskKey } from '../stores/CurrentDoingTaskStore';\nimport { ClickParam } from 'antd/lib/menu';\n// import { DateType } from 'antd/lib/date-picker';\nimport { DownOutlined } from '@ant-design/icons';\nimport moment from 'moment'\n\nconst Container = styled.div`\n  background: #ffffff;\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n`\n\nconst Div = styled.div`\n`\n\nconst Editor = styled(Input.TextArea)`\n  flex-grow: 1;\n`\n\nconst ButtonGroup = styled(Button.Group)`\nmargin: 2px;\n`\n\nconst ContentLayout: React.FC = () => {\n  const { storeModel } = stores.useStore('mainmodel') as { storeModel: StoreModel };\n  const { currentTask } = stores.useStore(CurrentTaskKey) as { currentTask: Task | undefined }\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n  const [content, setContent] = useState(\"\")\n  const [timeline, setTimeline] = useState(\"\")\n\n  const [isExpectConsume, setExpectConsumeUI] = useState(false);\n  const [expectTime, setExpectTime] = useState(-1);\n\n  const [isHaveDeadline, setHaveDeadlineUI] = useState(false);\n  const [deadline, setDeadlineUI] = useState<any>(null);\n\n  const [isPending, setPendingUI] = useState(false);\n  const [pendingReason, setPendingReason] = useState(\"\");\n  const [pendingTime, setPendingTimeUI] = useState<any>(null);\n\n  const [expectStartTime, setExpectStartTimeUI] = useState<any>(null);\n\n\n  // toolsbar\n  const { currentDoingTask, setCurrentDoingTask } = stores.useStore(CurrentDoingTaskKey) as { currentDoingTask: Task | undefined, setCurrentDoingTask: (note: Task | undefined) => void }\n\n  /* ---------------------------初始化------------------------------- */\n\n  // 渲染当前note\n  const [lastTask, setLastTask] = useState<Task | undefined>(undefined)\n  useEffect(() => {\n    // console.log(`Current content:${content}`)\n    if (currentTask === undefined) return\n\n    if (!currentTask.isSameTask(lastTask)) {\n      // todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\n      setLastTask(currentTask)\n      setContent(currentTask.note.content)\n\n      // todo 这部分逻辑抽出去\n      const expectTime = currentTask.getActualExpectConsume()\n      if (expectTime < 0) {\n        setExpectTime(expectTime)\n        setExpectConsume(false)\n      } else {\n        setExpectConsume(true)\n        setExpectTime(expectTime / (3600 * 1000))\n      }\n\n      setPendingUI(currentTask.isPending())\n      setPendingReason(currentTask.pendingReason)\n      setPendingTimeUI(getPendingDeadlineTime(currentTask))\n\n      setDeadlineUI(getDeadlineTime(currentTask))\n      setHaveDeadline(currentTask.isHaveDeadline())\n\n      if (currentTask !== undefined && !currentTask.isStarted()) {\n        setExpectStartTimeUI(moment(currentTask.expectStartTime))\n      } else {\n        setExpectStartTimeUI(null)\n      }\n\n      storeModel.normalUpdate()\n    }\n  })\n\n  /* ----------------------------保存Note文本------------------------------ */\n\n  function onBlur(event: any) {\n    event.preventDefault();\n    saveToLocal(event, false)\n  }\n\n  function saveToLocal(event: any, isManual: boolean) {\n    if (event) event.preventDefault();\n    if (currentTask === undefined) return\n\n    currentTask.note.content = content\n    save()\n\n    if (isManual) message.info(\"已保存\")\n  }\n\n  /* ------------------------------toolsbar---------------------------- */\n\n  function deleteTask(event: any) {\n    if (currentTask === undefined) return\n\n    Modal.confirm({\n      title: '确定要删除吗？',\n      content: `是否删除任务：${currentTask.title}`,\n      onOk() {\n        if (storeModel.removeTask(currentTask)) {\n          message.success(\"删除任务成功\")\n          save()\n        } else {\n          message.error(\"删除任务失败\")\n        }\n      },\n    });\n  }\n\n  function doneTask(event: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (task.isDone()) {\n      message.error(`任务已完成，完成时间:${Format.formatTimeInMs(task.doneTime)}`)\n      return\n    }\n\n    if (!task.isDoing()) {\n      Modal.confirm({\n        title: '当前任务不在进行中，确定要完成吗？',\n        content: `是否完成任务：${task.title}`,\n        onOk() {\n          _realDone(task)\n        },\n      });\n      return\n    }\n\n    task.stop()\n    setCurrentDoingTask(undefined)\n    _realDone(task)\n  }\n\n  function _realDone(task: Task) {\n    task.done()\n    storeModel.normalUpdate()\n    message.success(\"任务已完成\")\n    save()\n  }\n\n  function onChooseDeadline(value: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    // 整了半天，原来直接 valueOf() 就行，百度了半天\n    // if(value instanceof Moment){\n    //   let moment:Moment = value\n    //   console.log('onOk: ', moment.);\n    // }\n    // console.log('onOk: ', value.valueOf());\n\n    task.deadlines.push(value.valueOf())\n    setDeadlineUI(getDeadlineTime(currentTask))\n    save()\n  }\n\n  function getDeadlineTime(task: Task): any {\n    const deadline = task.getActualDeadline();\n    if (deadline > 0) {\n      return moment(deadline)\n    }\n\n    return null\n  }\n\n  function getShowTips(): string {\n    if (currentTask === undefined) return \"\"\n    const task = currentTask\n\n    let result = TaskInfoFormat.getDoingStatusTips(task) + TaskInfoFormat.getConsumed(task) + TaskInfoFormat.getDeadline(task) + TaskInfoFormat.getConsumeExpected(task) + TaskInfoFormat.getStartExpected(task)\n    return result\n  }\n\n  function changeExceptTime() {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (expectTime == -1) {\n      task.expectConsumes.push(-1) // todo 暂时不优化交互了，-1就是不设置时间\n    } else {\n      task.expectConsumes.push(expectTime * 3600 * 1000)\n    }\n\n    save()\n  }\n\n  /* ---------------------------------------------------------- */\n\n  function onChoosePendingDeadline(value: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (!isPending) {\n      message.error(`设置无效，请打开 pending 开关后重新设置`)\n      return\n    }\n\n    const pendingLine = value.valueOf()\n    if (!isTimeValid(pendingLine, \"Pending时间\", Duration.create(undefined, task.getActualDeadline(), \"Deadline\"))) {\n      return\n    }\n\n    task.pendingDeadline = pendingLine\n    setPendingTimeUI(getPendingDeadlineTime(task))\n    save()\n  }\n\n  function onChangeExpectStartTime(value: any, task: Task) {\n    const expectStartTime = value.valueOf()\n\n    if (!isTimeValid(expectStartTime, \"预期开始时间\", Duration.create(undefined, task.pendingDeadline, \"PendLine\"), Duration.create(undefined, task.getActualDeadline(), \"Deadline\"))) {\n      return\n    }\n\n    setExpectStartTimeUI(expectStartTime)\n    task.expectStartTime = expectStartTime\n    save()\n  }\n\n  function isTimeValid(time: number, timeName: string, ...limitDurations: Duration[]): boolean {\n    let isValid = true\n    for (let index = 0; index < limitDurations.length; index++) {\n      const dur = limitDurations[index];\n      if (dur.start > 0 && time < dur.start) {\n        message.error(`${timeName}(${Format.formatTimeInMinute(time)})早于${dur.start}(${Format.formatTimeInMinute(dur.start)})，请重新设置`)\n        isValid = false\n      } else if (dur.end > 0 && time > dur.end) {\n        message.error(`${timeName}(${Format.formatTimeInMinute(time)})晚于${dur.end}(${Format.formatTimeInMinute(dur.end)})，请重新设置`)\n        isValid = false\n      }\n      if (!isValid) {\n        return false\n      }\n    }\n    return true\n  }\n\n  function getPendingDeadlineTime(task: Task): any {\n    const deadline = task.pendingDeadline\n\n    if (deadline > 0) {\n      return moment(deadline)\n    }\n\n    return null\n  }\n\n  function savePendingStatus() {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    task.pendingReason = pendingReason\n    save()\n  }\n\n  function setPending(pendingStatus: boolean) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (!pendingStatus) {\n      task.pendingDeadline = -1\n      setPendingTimeUI(null)\n      save()\n    }\n    setPendingUI(pendingStatus)\n  }\n\n  function setExpectConsume(pendingStatus: boolean) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    // 关闭就不估时并保存\n    if (!pendingStatus) {\n      task.expectConsumes.push(-1)\n      setExpectTime(-1)\n      save()\n    }\n    setExpectConsumeUI(pendingStatus)\n  }\n\n  function setHaveDeadline(pendingStatus: boolean) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    // 关闭就不估时并保存\n    if (!pendingStatus) {\n      task.deadlines.push(-1)\n      setDeadlineUI(null)\n      save()\n    }\n    setHaveDeadlineUI(pendingStatus)\n  }\n\n  function onAddTimeline(event: any) {\n    event.preventDefault();\n\n    if (currentTask === undefined) return\n\n    if (Utils.isStringEmpty(timeline)) {\n      message.error(\"请输入内容\")\n      return\n    }\n\n    const endTimeline = currentTask.note.endTimeLine();\n    if (endTimeline == null || !DateUtils.isSameDay(endTimeline.timeStamp, Utils.getTimestamp())) {\n      currentTask.note.timeLines.push(TimeLine.createDivNode())\n    }\n\n    currentTask.note.timeLines.push(TimeLine.createContentNode(timeline))\n\n    save()\n\n    setTimeline(\"\")\n  }\n\n  /* ---------------------------------------------------------- */\n\n  if (currentTask === undefined) return null\n\n  return (\n    <Container style={{ margin: \"5px\" }}>\n      {/* 不加这个 div 会换行 */}\n      {currentTask !== undefined &&\n        <Div style={{ margin: \"5px\" }}>\n          <ButtonGroup>\n            {/* <Button type=\"primary\" size=\"small\">view</Button> */}\n            <Button onClick={(e) => deleteTask(e)}>D</Button>\n            {/* <Button type=\"primary\" size=\"small\" onClick={(e) => startTask(e, task)}>Stop</Button> */}\n            <Button onClick={(e) => doneTask(e)}>Done</Button>\n          </ButtonGroup>\n\n          <Switch style={{ marginLeft: '5px', marginRight: '3px' }} checkedChildren=\"估时\" unCheckedChildren=\"不限\" checked={isExpectConsume} onChange={(event) => setExpectConsume(event)} />\n\n          <Switch style={{ marginLeft: '5px', marginRight: '3px' }} checkedChildren=\"截止时间\" unCheckedChildren=\"没有截止\" checked={isHaveDeadline} onChange={(event) => setHaveDeadline(event)} />\n\n          <Switch style={{ marginLeft: '9px', marginRight: '5px' }} checkedChildren=\"Pending\" unCheckedChildren=\"NoPend\" checked={isPending} onChange={(event) => setPending(event)} />\n\n        </Div>\n      }\n\n\n      <div style={{ marginLeft: \"15px\", marginRight: \"15px\", fontWeight: \"bold\" }} >{getShowTips()}</div>\n\n\n      <Div style={{ marginTop: \"5px\", marginBottom: \"5px\" }}>\n        {expectStartTime !== null &&\n          <span style={{ marginLeft: \"15px\" }} >预期开始时间：\n          <DatePicker showTime value={expectStartTime} onOk={value => onChangeExpectStartTime(value, currentTask)} />\n          </span>\n        }\n\n        {isExpectConsume &&\n          <span style={{ marginLeft: \"15px\" }} >估时：\n        <Input style={{ width: '100px' }} value={expectTime} placeholder=\"花费时间 回车保存\" prefix=\"预计\" suffix=\"h\" onChange={(event) => setExpectTime(Number(event.target.value))} onBlur={changeExceptTime} />\n          </span>\n        }\n\n        {isHaveDeadline &&\n          <span style={{ marginLeft: \"15px\" }} >DeadLine：\n        <DatePicker showTime value={deadline} onOk={value => onChooseDeadline(value)} />\n          </span>\n        }\n\n        {isPending &&\n          <span style={{ marginLeft: \"15px\" }} >Pending：\n      <DatePicker showTime value={pendingTime} onOk={value => onChoosePendingDeadline(value)} />\n\n            <Input style={{ width: '200px' }} value={pendingReason} prefix=\"原因:\" placeholder=\"（自动保存）\" onChange={(event) => setPendingReason(event.target.value)} onBlur={savePendingStatus} />\n          </span>\n        }\n\n      </Div>\n\n      {currentTask !== undefined &&\n        <Div style={{ marginLeft: \"15px\" }} >\n          <Input placeholder=\"输入时间线，回车添加\" value={timeline} onChange={(event) => setTimeline(event.target.value)} onPressEnter={onAddTimeline} />\n          <Div style={{ height: \"250px\", overflow: \"scroll\", whiteSpace:\"pre-wrap\" }}>\n            {currentTask.note.getFormartTimeLines()}\n          </Div>\n        </Div>\n\n      }\n\n      <Editor\n        placeholder=\"任务日志（自动保存）\" value={content} onChange={(event) => setContent(event.target.value)} onBlur={(e) => onBlur(e)}\n      />\n    </Container>\n  );\n}\n\nexport default ContentLayout;"]},"metadata":{},"sourceType":"module"}