{"ast":null,"code":"import _slicedToArray from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject5(){var data=_taggedTemplateLiteral([\"\\nbackground-color: \",\";\\n:hover{\\n\\tbackground-color:#b4e7fc;\\n};\\nopacity : \",\";;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\nmargin: 1%;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\nmargin: 1%;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  /* background: #d1d3a2; */\\n  /* background: #d1dfff; */\\n  background: #282c34;\\n  overflow:auto;\\n  /* height: 800px; */\\n  height: 85vh;\\n  margin-top:10px;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  /* background: #d1d3a2; */\\n  /* background: #d1dfff; */\\n  background: #282c34;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect}from'react';import styled from'styled-components';import{Input,message,Button,List,Dropdown,Menu,Modal,DatePicker}from'antd';// 这样居然真的行\n// import { DateType } from 'antd/lib/date-picker';\nimport{DownOutlined}from'@ant-design/icons';import stores from'../stores';import{StoreModel}from'../model/model';import Utils from'../utils/Utils';import DateUtils from'../utils/DateUtils';import Format from'../utils/Format';import{Task}from'../model/model';import{CurrentTaskKey}from'../stores/CurrentTaskStore';import{CurrentDoingTaskKey}from'../stores/CurrentDoingTaskStore';import{CurrentDayOffsetKey}from'../stores/CurrentDayOffsetStore';import'antd/dist/antd.css';import moment from'moment';import{plainToClass}from\"class-transformer\";var Container=styled.div(_templateObject());var Container2=styled.div(_templateObject2());var InputGroup=styled(Input.Group)(_templateObject3());var ButtonGroup=styled(Button.Group)(_templateObject4());var TaskListContainer=function TaskListContainer(){var _ref=stores.useStore('mainmodel'),storeModel=_ref.storeModel,save=_ref.save,setModel=_ref.setModel;var _ref2=stores.useStore(CurrentDayOffsetKey),currentDayOffset=_ref2.currentDayOffset,setCurrentDayOffset=_ref2.setCurrentDayOffset;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState(2),_useState4=_slicedToArray(_useState3,2),expectTime=_useState4[0],setExpectTime=_useState4[1];// React.useEffect(() => {\n//   console.log(\"TaskListContainer useEffect\")\n// },[])\nfunction onAddNote(event){event.preventDefault();if(Utils.isStringEmpty(title)){message.error(\"请输入内容\");return;}var newTask=new Task();newTask.init(title);newTask.expectConsumes.push(expectTime*3600*1000);// 单位小时，转换\nstoreModel.addTask(newTask);storeModel.orderTasks();save();setTitle(\"\");}function changeOffsetDay(isAdd){if(isAdd){setCurrentDayOffset(currentDayOffset+1);}else{setCurrentDayOffset(currentDayOffset-1);}}function download(){Utils.downloadFile(\"DoingList_\".concat(Format.formatTimeInMsToFileName(Utils.getTimestamp()),\".dl\"),JSON.stringify(storeModel));}function upload(e){var file=e.target.files[0];console.log(file);var reader=new FileReader();reader.onload=function(){var uploadContent=this.result;if(typeof uploadContent==='string'){Modal.confirm({title:'确定要导入嘛？',content:\"\\u5BFC\\u5165\\u4F1A\\u8986\\u76D6\\u5F53\\u524D\\u6240\\u6709\\u4EFB\\u52A1\",onOk:function onOk(){Modal.confirm({title:'是否需要先下载当前任务？',content:\"\",onOk:function onOk(){download();setModel(plainToClass(StoreModel,JSON.parse(uploadContent)));},onCancel:function onCancel(){setModel(plainToClass(StoreModel,JSON.parse(uploadContent)));}});}});}else{message.error(\"导入文件有问题，导入失败\");}};//读取文件内容\nreader.readAsText(file);}function getOffsetString(){var base=\"\"+currentDayOffset;if(currentDayOffset>0){base=\"+\"+base;}return base;}function getAllTaskStatus(){var notDoneTasks=storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)).filter(function(task){return!task.isDone();});if(notDoneTasks.length===0){return\"\";}var consumeFormat=\"\";var consumes=notDoneTasks.map(function(task){var left=task.getLeftExpectConsumeTime();if(left<0)return 0;return left;}).reduce(function(a,b){return a+b;});// console.log(\"getAllTaskStatus\" + consumes)\nif(consumes>0){consumeFormat=\"\\uFF0C\\u603B\\u5269\\u4F59\\u9884\\u4F30\\u9700\\u8981\\u82B1\\u8D39\".concat(Format.formatDuration(consumes));}return\"\\u5171\".concat(notDoneTasks.length,\"\\u4E2A\\u4EFB\\u52A1\\u672A\\u5B8C\\u6210\").concat(consumeFormat);}return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(ButtonGroup,null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return changeOffsetDay(false);}},\"\\u2190\"),/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:\"#ffffff\",padding:4}},Format.formatTimeInDay(DateUtils.getMyCurrentDayStamp(currentDayOffset)),\"(\",getOffsetString(),\")\"),/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return changeOffsetDay(true);}},\"\\u2192\"),/*#__PURE__*/React.createElement(\"span\",{style:{paddingLeft:10}}),/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return download();}},\"\\u5BFC\\u51FA\"),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",id:\"upload-file\",multiple:true,onChange:function onChange(event){return upload(event);}})),/*#__PURE__*/React.createElement(Input.Group,{compact:true,style:{width:'96%',margin:'2%'}},/*#__PURE__*/React.createElement(Input,{style:{width:'80%'},placeholder:\"\\u8F93\\u5165\\u4EFB\\u52A1\\uFF0C\\u56DE\\u8F66\\u6DFB\\u52A0\",value:title,onChange:function onChange(event){return setTitle(event.target.value);},onPressEnter:onAddNote}),/*#__PURE__*/React.createElement(Input,{style:{width:'20%'},defaultValue:expectTime,placeholder:\"\\u82B1\\u8D39\\u65F6\\u95F4\",prefix:\"\\u9884\\u8BA1\",suffix:\"h\",onChange:function onChange(event){return setExpectTime(Number(event.target.value));},onPressEnter:onAddNote})),/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:\"#ffffff\",padding:4,margin:'2%'}},getAllTaskStatus()),/*#__PURE__*/React.createElement(NoteList,null));};var NoteItem=styled.div(_templateObject5(),function(props){if(props.choosed){return'#f5b52b';}else{return'#ffffff';}},function(props){if(props.isDone){return 0.15;}else{return 1;}});var NoteList=function NoteList(){var _ref3=stores.useStore('mainmodel'),storeModel=_ref3.storeModel;var _ref4=stores.useStore(CurrentTaskKey),currentTask=_ref4.currentTask,setCurrentTask=_ref4.setCurrentTask;var _ref5=stores.useStore(CurrentDoingTaskKey),currentDoingTask=_ref5.currentDoingTask,setCurrentDoingTask=_ref5.setCurrentDoingTask;var _ref6=stores.useStore('mainmodel'),save=_ref6.save;var _ref7=stores.useStore(CurrentDayOffsetKey),currentDayOffset=_ref7.currentDayOffset,setCurrentDayOffset=_ref7.setCurrentDayOffset;useEffect(function(){// console.log(\"NoteList useEffect\")\nif(currentDoingTask===undefined){var doingTasks=storeModel.tasks.filter(function(value){return value.isDoing();});if(doingTasks.length===0){return;}if(doingTasks.length>1){console.error(\"\\u6709 \".concat(doingTasks.length,\" \\u4E2A\\u4EFB\\u52A1\\u5728\\u8FD0\\u884C\\u4E2D\\uFF0C\\u81EA\\u52A8\\u5173\\u95ED\"));for(var i=1;i<doingTasks.length;i++){doingTasks[i].stop();}}setCurrentDoingTask(doingTasks[0]);}});function onChooseNote(event,note){event.preventDefault();setCurrentTask(note);}var onClickMenu=function onClickMenu(param,task){task.level=Number(param.key);storeModel.orderTasks();save();param.domEvent.preventDefault();// 怎么阻止对 parent 的点击事件\n// param.domEvent.stopPropagation()\n};function getMenu(task){return/*#__PURE__*/React.createElement(Menu,{onClick:function onClick(param){return onClickMenu(param,task);}},/*#__PURE__*/React.createElement(Menu.Item,{key:\"1\"},\"\\u4F18\\u5148\\u7EA7 1\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"2\"},\"\\u4F18\\u5148\\u7EA7 2\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"3\"},\"\\u4F18\\u5148\\u7EA7 3\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"4\"},\"\\u4F18\\u5148\\u7EA7 4\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"5\"},\"\\u4F18\\u5148\\u7EA7 5\"));}function deleteTask(event,task){Modal.confirm({title:'确定要删除吗？',content:\"\\u662F\\u5426\\u5220\\u9664\\u4EFB\\u52A1\\uFF1A\".concat(task.title),onOk:function onOk(){if(storeModel.removeTask(task)){message.success(\"删除任务成功\");save();}else{message.error(\"删除任务失败\");}}});}function startTask(event,task){if(task.isDone()){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u5B8C\\u6210\\uFF0C\\u5B8C\\u6210\\u65F6\\u95F4:\".concat(Format.formatTimeInMs(task.doneTime)));return;}if(currentDoingTask!=undefined&&currentDoingTask.id===task.id){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u7ECF\\u5728\\u8FDB\\u884C\\u4E2D\\uFF0C\\u4E0A\\u6B21\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\".concat(Format.formatTimeInMs(task.lastStartTime())));return;}if(task.isDoing()){// todo 自动恢复\nmessage.error(\"\\u4EFB\\u52A1\\u5F02\\u5E38\\u4E2D\\u65AD\\uFF0C\\u91CD\\u65B0\\u5F00\\u59CB\\u3002\\u4E0A\\u6B21\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\".concat(Format.formatTimeInMs(task.lastStartTime())));}if(currentDoingTask!=undefined){currentDoingTask.stop();}task.start();setCurrentDoingTask(task);save();}function doneTask(event,task){if(task.isDone()){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u5B8C\\u6210\\uFF0C\\u5B8C\\u6210\\u65F6\\u95F4:\".concat(Format.formatTimeInMs(task.doneTime)));return;}if(!task.isDoing()){Modal.confirm({title:'当前任务不在进行中，确定要完成吗？',content:\"\\u662F\\u5426\\u5B8C\\u6210\\u4EFB\\u52A1\\uFF1A\".concat(task.title),onOk:function onOk(){_realDone(task);}});return;}task.stop();setCurrentDoingTask(undefined);_realDone(task);}function _realDone(task){task.done();storeModel.orderTasks();message.success(\"任务已完成\");save();}function getDoingStatusTips(task){if(task.isDoing()){return\"施工中⛑ \";}else{return\"\";}}function getConsumed(task){var time=Format.formatDuration(task.getAllDuration());if(Utils.isStringEmpty(time)){return\"\";}return\"\\u8FDB\\u884C\".concat(time,\"(\").concat(task.doingDurs.length,\"\\u6B21) \");}function getDeadline(task){var deadline=task.getActualDeadline();if(deadline<=0){return\"\";}var leftTime=deadline-Utils.getTimestamp();if(leftTime<=1000){return\"\\u5DF2\\u8D85\\u671F\\uD83D\\uDE31 \";}var time=Format.formatDuration(leftTime);return\"\\u5269\\u4F59\".concat(time,\" \");}function getConsumeExpected(task){if(task.getActualExpectConsume()<=0){return\"\";}var left=task.getLeftExpectConsumeTime();if(left<=0){return\"\\u8D85\\u51FA\".concat(Format.formatDuration(-left));}else{return\"\\u8FD8\\u9700\".concat(Format.formatDuration(left));}}function getShowTips(task){var result=\"  \"+getDoingStatusTips(task)+getConsumed(task)+getDeadline(task)+getConsumeExpected(task);return result;}function onChooseDeadline(value,task){// 整了半天，原来直接 valueOf() 就行，百度了半天\n// if(value instanceof Moment){\n//   let moment:Moment = value\n//   console.log('onOk: ', moment.);\n// }\n// console.log('onOk: ', value.valueOf());\ntask.deadlines.push(value.valueOf());}function getDeadlineTime(task){var deadline=task.getActualDeadline();if(deadline>0){return moment(deadline);}return undefined;}function formartLevel(level){switch(level){case 1:return\"❗\";case 2:return\"🎏\";case 3:return\"3️⃣\";case 4:return\"4️\";case 5:return\"5️\";default:return\"\";}}return/*#__PURE__*/React.createElement(Container2,null,/*#__PURE__*/React.createElement(List,{size:\"small\",style:{backgroundColor:'white',margin:\"1%\"},bordered:true,dataSource:storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)),renderItem:function renderItem(task){return/*#__PURE__*/React.createElement(NoteItem,{choosed:task.isSameTask(currentTask),key:task.id,onClick:function onClick(e){return onChooseNote(e,task);},isDone:task.isDone()},/*#__PURE__*/React.createElement(NoteItemInput,{key:task.id,task:task}),/*#__PURE__*/React.createElement(ButtonGroup,null,/*#__PURE__*/React.createElement(Button,{size:\"small\",onClick:function onClick(e){return deleteTask(e,task);}},\"D\"),/*#__PURE__*/React.createElement(Button,{size:\"small\",onClick:function onClick(e){return doneTask(e,task);}},\"Done\"),/*#__PURE__*/React.createElement(Button,{size:\"small\",onClick:function onClick(e){return startTask(e,task);}},\"Start\"),/*#__PURE__*/React.createElement(Dropdown,{overlay:getMenu(task)},/*#__PURE__*/React.createElement(\"a\",{style:{paddingLeft:5},className:\"ant-dropdown-link\",onClick:function onClick(e){return e.preventDefault();}},formartLevel(task.level),\" \",/*#__PURE__*/React.createElement(DownOutlined,null)))),/*#__PURE__*/React.createElement(DatePicker,{showTime:true,defaultValue:getDeadlineTime(task),onOk:function onOk(value){return onChooseDeadline(value,task);},size:\"small\"}),getShowTips(task));}}));};var NoteItemInput=function NoteItemInput(props){var _useState5=useState(props.task.title),_useState6=_slicedToArray(_useState5,2),content=_useState6[0],setContent=_useState6[1];var _ref8=stores.useStore('mainmodel'),save=_ref8.save;function saveTaskTitle(event){props.task.title=content;save();}return/*#__PURE__*/React.createElement(Input,{style:{background:\"#ffffff70\"},value:content,onChange:function onChange(e){return setContent(e.target.value);},onBlur:saveTaskTitle});};export default TaskListContainer;","map":{"version":3,"sources":["/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/TaskListContainer.tsx"],"names":["React","useState","useEffect","styled","Input","message","Button","List","Dropdown","Menu","Modal","DatePicker","DownOutlined","stores","StoreModel","Utils","DateUtils","Format","Task","CurrentTaskKey","CurrentDoingTaskKey","CurrentDayOffsetKey","moment","plainToClass","Container","div","Container2","InputGroup","Group","ButtonGroup","TaskListContainer","useStore","storeModel","save","setModel","currentDayOffset","setCurrentDayOffset","title","setTitle","expectTime","setExpectTime","onAddNote","event","preventDefault","isStringEmpty","error","newTask","init","expectConsumes","push","addTask","orderTasks","changeOffsetDay","isAdd","download","downloadFile","formatTimeInMsToFileName","getTimestamp","JSON","stringify","upload","e","file","target","files","console","log","reader","FileReader","onload","uploadContent","result","confirm","content","onOk","parse","onCancel","readAsText","getOffsetString","base","getAllTaskStatus","notDoneTasks","getTasks","getMyCurrentDayDur","filter","task","isDone","length","consumeFormat","consumes","map","left","getLeftExpectConsumeTime","reduce","a","b","formatDuration","backgroundColor","padding","formatTimeInDay","getMyCurrentDayStamp","paddingLeft","width","margin","value","Number","NoteItem","props","choosed","NoteList","currentTask","setCurrentTask","currentDoingTask","setCurrentDoingTask","undefined","doingTasks","tasks","isDoing","i","stop","onChooseNote","note","onClickMenu","param","level","key","domEvent","getMenu","deleteTask","removeTask","success","startTask","formatTimeInMs","doneTime","id","lastStartTime","start","doneTask","_realDone","done","getDoingStatusTips","getConsumed","time","getAllDuration","doingDurs","getDeadline","deadline","getActualDeadline","leftTime","getConsumeExpected","getActualExpectConsume","getShowTips","onChooseDeadline","deadlines","valueOf","getDeadlineTime","formartLevel","isSameTask","NoteItemInput","setContent","saveTaskTitle","background"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Button, List, Dropdown, Menu, Modal, DatePicker } from 'antd';\n// 这样居然真的行\nimport { ClickParam } from 'antd/lib/menu';\n// import { DateType } from 'antd/lib/date-picker';\nimport { DownOutlined } from '@ant-design/icons';\nimport stores from '../stores';\nimport { StoreModel, Duration } from '../model/model'\nimport Utils from '../utils/Utils'\nimport DateUtils from '../utils/DateUtils'\nimport Format from '../utils/Format'\nimport { Task, Note } from '../model/model'\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport { CurrentDoingTaskKey } from '../stores/CurrentDoingTaskStore';\nimport { CurrentDayOffsetKey } from '../stores/CurrentDayOffsetStore';\nimport 'antd/dist/antd.css';\nimport moment from 'moment'\nimport { plainToClass } from \"class-transformer\";\n\nconst Container = styled.div`\n  /* background: #d1d3a2; */\n  /* background: #d1dfff; */\n  background: #282c34;\n`\n\nconst Container2 = styled.div`\n  /* background: #d1d3a2; */\n  /* background: #d1dfff; */\n  background: #282c34;\n  overflow:auto;\n  /* height: 800px; */\n  height: 85vh;\n  margin-top:10px;\n`\n\nconst InputGroup = styled(Input.Group)`\nmargin: 1%;\n`\nconst ButtonGroup = styled(Button.Group)`\nmargin: 1%;\n`\n\nconst TaskListContainer: React.FC = () => {\n  const { storeModel, save, setModel } = stores.useStore('mainmodel') as { storeModel: StoreModel, save: () => void, setModel: (storeModel: StoreModel) => void };\n  const { currentDayOffset, setCurrentDayOffset } = stores.useStore(CurrentDayOffsetKey) as { currentDayOffset: number, setCurrentDayOffset: (offset: number) => void }\n  const [title, setTitle] = useState(\"\");\n  const [expectTime, setExpectTime] = useState(2);\n\n  // React.useEffect(() => {\n  //   console.log(\"TaskListContainer useEffect\")\n  // },[])\n\n  function onAddNote(event: any) {\n    event.preventDefault();\n\n    if (Utils.isStringEmpty(title)) {\n      message.error(\"请输入内容\")\n      return\n    }\n\n    const newTask = new Task()\n    newTask.init(title)\n    newTask.expectConsumes.push(expectTime * 3600 * 1000) // 单位小时，转换\n    storeModel.addTask(newTask)\n    storeModel.orderTasks()\n    save()\n\n    setTitle(\"\")\n  }\n\n  function changeOffsetDay(isAdd: boolean) {\n    if (isAdd) {\n      setCurrentDayOffset(currentDayOffset + 1)\n    } else {\n      setCurrentDayOffset(currentDayOffset - 1)\n    }\n  }\n\n  function download() {\n    Utils.downloadFile(`DoingList_${Format.formatTimeInMsToFileName(Utils.getTimestamp())}.dl`, JSON.stringify(storeModel))\n  }\n\n  function upload(e: any) {\n    let file = e.target.files[0];\n    console.log(file)\n\n    let reader = new FileReader();\n    reader.onload = function (this) {\n      let uploadContent = this.result\n      if (typeof uploadContent === 'string') {\n        Modal.confirm({\n          title: '确定要导入嘛？',\n          content: `导入会覆盖当前所有任务`,\n          onOk() {\n            Modal.confirm({\n              title: '是否需要先下载当前任务？',\n              content: ``,\n              onOk() {\n                download()\n                setModel(plainToClass(StoreModel, JSON.parse(uploadContent as string)))\n              },\n              onCancel() {\n                setModel(plainToClass(StoreModel, JSON.parse(uploadContent as string)))\n              }\n            });\n          },\n        })\n      } else {\n        message.error(\"导入文件有问题，导入失败\")\n      }\n    }\n    //读取文件内容\n    reader.readAsText(file);\n  }\n\n  function getOffsetString() {\n    let base = \"\" + currentDayOffset\n    if (currentDayOffset > 0) {\n      base = \"+\" + base\n    }\n    return base\n  }\n\n  function getAllTaskStatus(): string {\n    let notDoneTasks = storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)).filter((task) => { return !task.isDone() })\n\n    if (notDoneTasks.length === 0) {\n      return \"\"\n    }\n\n    let consumeFormat = \"\"\n    let consumes: number = notDoneTasks.map((task) => {\n      let left = task.getLeftExpectConsumeTime()\n      if (left < 0) return 0\n      return left\n    }).reduce((a, b) => a + b)\n\n    // console.log(\"getAllTaskStatus\" + consumes)\n    if (consumes > 0) {\n      consumeFormat = `，总剩余预估需要花费${Format.formatDuration(consumes)}`\n    }\n\n    return `共${notDoneTasks.length}个任务未完成${consumeFormat}`\n  }\n\n  return (\n    <Container>\n\n      {/* todo 这个组件可以单独抽出去 */}\n      <ButtonGroup>\n        <Button type=\"primary\" size=\"small\" onClick={(e) => changeOffsetDay(false)}>←</Button>\n\n        {/* 这个取当前时间的操作简直无敌... 蠢 */}\n        {/* <DatePicker defaultValue={moment(moment().format(dateFormat), dateFormat)} format={dateFormat} /> */}\n\n        <span style={{ backgroundColor: \"#ffffff\", padding: 4 }} >\n          {Format.formatTimeInDay(DateUtils.getMyCurrentDayStamp(currentDayOffset))}({getOffsetString()})\n        </span>\n\n        <Button type=\"primary\" size=\"small\" onClick={(e) => changeOffsetDay(true)}>→</Button>\n        <span style={{ paddingLeft: 10 }} ></span>\n        <Button type=\"primary\" size=\"small\" onClick={(e) => download()}>导出</Button>\n        <input type=\"file\" id=\"upload-file\" multiple onChange={(event) => upload(event)} />\n        {/* <Button type=\"primary\" size=\"small\" onClick={(e) => download()}>导入</Button> */}\n      </ButtonGroup>\n\n      <Input.Group compact style={{ width: '96%', margin: '2%' }}>\n        <Input style={{ width: '80%' }} placeholder=\"输入任务，回车添加\" value={title} onChange={(event) => setTitle(event.target.value)} onPressEnter={onAddNote} />\n        <Input style={{ width: '20%' }} defaultValue={expectTime} placeholder=\"花费时间\" prefix=\"预计\" suffix=\"h\" onChange={(event) => setExpectTime(Number(event.target.value))} onPressEnter={onAddNote} />\n      </Input.Group>\n\n      <span style={{ backgroundColor: \"#ffffff\", padding: 4, margin: '2%' }} >\n        {getAllTaskStatus()}\n      </span>\n\n      <NoteList />\n    </Container>\n  );\n}\n\n\nconst NoteItem = styled.div`\nbackground-color: ${(props: { choosed: boolean, isDone: boolean }) => {\n    if (props.choosed) {\n      return '#f5b52b'\n    } else {\n      return '#ffffff'\n    }\n  }\n  };\n:hover{\n\tbackground-color:#b4e7fc;\n};\nopacity : ${(props: { choosed: boolean, isDone: boolean }) => {\n    if (props.isDone) {\n      return 0.15\n    } else {\n      return 1\n    }\n  }\n  };;\n`\nconst NoteList: React.FC = () => {\n  const { storeModel } = stores.useStore('mainmodel') as { storeModel: StoreModel };\n  const { currentTask, setCurrentTask } = stores.useStore(CurrentTaskKey) as { currentTask: Task | undefined, setCurrentTask: (note: Task) => void }\n  const { currentDoingTask, setCurrentDoingTask } = stores.useStore(CurrentDoingTaskKey) as { currentDoingTask: Task | undefined, setCurrentDoingTask: (note: Task | undefined) => void }\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n  const { currentDayOffset, setCurrentDayOffset } = stores.useStore(CurrentDayOffsetKey) as { currentDayOffset: number, setCurrentDayOffset: (offset: number) => void }\n\n  useEffect(() => {\n    // console.log(\"NoteList useEffect\")\n\n    if (currentDoingTask === undefined) {\n      let doingTasks = storeModel.tasks.filter((value) => { return value.isDoing() })\n\n      if (doingTasks.length === 0) {\n        return\n      }\n\n      if (doingTasks.length > 1) {\n        console.error(`有 ${doingTasks.length} 个任务在运行中，自动关闭`)\n\n        for (let i = 1; i < doingTasks.length; i++) {\n          doingTasks[i].stop()\n        }\n      }\n\n      setCurrentDoingTask(doingTasks[0])\n    }\n  });\n\n  function onChooseNote(event: any, note: Task) {\n    event.preventDefault()\n    setCurrentTask(note)\n  }\n\n  const onClickMenu = (param: ClickParam, task: Task) => {\n    task.level = Number(param.key)\n\n    storeModel.orderTasks()\n    save()\n\n    param.domEvent.preventDefault()\n\n    // 怎么阻止对 parent 的点击事件\n    // param.domEvent.stopPropagation()\n  };\n\n  function getMenu(task: Task): React.ReactElement {\n    return (\n      <Menu onClick={(param) => onClickMenu(param, task)}>\n        <Menu.Item key=\"1\">优先级 1</Menu.Item>\n        <Menu.Item key=\"2\">优先级 2</Menu.Item>\n        <Menu.Item key=\"3\">优先级 3</Menu.Item>\n        <Menu.Item key=\"4\">优先级 4</Menu.Item>\n        <Menu.Item key=\"5\">优先级 5</Menu.Item>\n      </Menu>\n    )\n  }\n\n  function deleteTask(event: any, task: Task) {\n    Modal.confirm({\n      title: '确定要删除吗？',\n      content: `是否删除任务：${task.title}`,\n      onOk() {\n        if (storeModel.removeTask(task)) {\n          message.success(\"删除任务成功\")\n          save()\n        } else {\n          message.error(\"删除任务失败\")\n        }\n      },\n    });\n  }\n\n  function startTask(event: any, task: Task) {\n    if (task.isDone()) {\n      message.error(`任务已完成，完成时间:${Format.formatTimeInMs(task.doneTime)}`)\n      return\n    }\n\n    if (currentDoingTask != undefined && currentDoingTask.id === task.id) {\n      message.error(`任务已经在进行中，上次开始时间：${Format.formatTimeInMs(task.lastStartTime())}`)\n      return\n    }\n\n    if (task.isDoing()) {\n      // todo 自动恢复\n      message.error(`任务异常中断，重新开始。上次开始时间：${Format.formatTimeInMs(task.lastStartTime())}`)\n    }\n\n    if (currentDoingTask != undefined) {\n      currentDoingTask.stop()\n    }\n\n    task.start()\n    setCurrentDoingTask(task)\n    save()\n  }\n\n  function doneTask(event: any, task: Task) {\n    if (task.isDone()) {\n      message.error(`任务已完成，完成时间:${Format.formatTimeInMs(task.doneTime)}`)\n      return\n    }\n\n    if (!task.isDoing()) {\n      Modal.confirm({\n        title: '当前任务不在进行中，确定要完成吗？',\n        content: `是否完成任务：${task.title}`,\n        onOk() {\n          _realDone(task)\n        },\n      });\n      return\n    }\n\n    task.stop()\n    setCurrentDoingTask(undefined)\n    _realDone(task)\n  }\n\n  function _realDone(task: Task) {\n    task.done()\n    storeModel.orderTasks()\n    message.success(\"任务已完成\")\n    save()\n  }\n\n  function getDoingStatusTips(task: Task): string {\n    if (task.isDoing()) {\n      return \"施工中⛑ \"\n    } else {\n      return \"\"\n    }\n  }\n\n  function getConsumed(task: Task): string {\n    let time = Format.formatDuration(task.getAllDuration());\n    if (Utils.isStringEmpty(time)) {\n      return \"\"\n    }\n    return `进行${time}(${task.doingDurs.length}次) `\n  }\n\n  function getDeadline(task: Task): string {\n    let deadline = task.getActualDeadline()\n    if (deadline <= 0) {\n      return \"\"\n    }\n    const leftTime = deadline - Utils.getTimestamp();\n    if (leftTime <= 1000) {\n      return `已超期😱 `\n    }\n    let time = Format.formatDuration(leftTime);\n    return `剩余${time} `\n  }\n\n  function getConsumeExpected(task: Task): string {\n    if (task.getActualExpectConsume() <= 0) {\n      return \"\"\n    }\n\n    let left = task.getLeftExpectConsumeTime()\n    if (left <= 0) {\n      return `超出${Format.formatDuration(-left)}`\n    } else {\n      return `还需${Format.formatDuration(left)}`\n    }\n  }\n\n  function getShowTips(task: Task): string {\n    let result = \"  \" + getDoingStatusTips(task) + getConsumed(task) + getDeadline(task) + getConsumeExpected(task)\n    return result\n  }\n\n  function onChooseDeadline(value: any, task: Task) {\n    // 整了半天，原来直接 valueOf() 就行，百度了半天\n    // if(value instanceof Moment){\n    //   let moment:Moment = value\n    //   console.log('onOk: ', moment.);\n    // }\n    // console.log('onOk: ', value.valueOf());\n\n    task.deadlines.push(value.valueOf())\n  }\n\n  function getDeadlineTime(task: Task): any {\n    const deadline = task.getActualDeadline();\n    if (deadline > 0) {\n      return moment(deadline)\n    }\n\n    return undefined\n  }\n\n  function formartLevel(level: number): string {\n    switch (level) {\n      case 1:\n        return \"❗\"\n      case 2:\n        return \"🎏\"\n      case 3:\n        return \"3️⃣\"\n      case 4:\n        return \"4️\"\n      case 5:\n        return \"5️\"\n      default:\n        return \"\"\n    }\n  }\n\n  return (\n    <Container2>\n      <List\n        size=\"small\"\n        style={{ backgroundColor: 'white', margin: \"1%\" }}\n        bordered\n        dataSource={storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset))}\n        renderItem={task => (\n          <NoteItem choosed={task.isSameTask(currentTask)} key={task.id} onClick={(e) => onChooseNote(e, task)} isDone={task.isDone()}>\n            <NoteItemInput key={task.id} task={task} />\n            <ButtonGroup>\n              {/* 点击整行就是查看且开始，view是只查看不开始。暂时用不着吧 */}\n              {/* <Button type=\"primary\" size=\"small\">view</Button> */}\n              <Button size=\"small\" onClick={(e) => deleteTask(e, task)}>D</Button>\n              {/* <Button type=\"primary\" size=\"small\" onClick={(e) => startTask(e, task)}>Stop</Button> */}\n              <Button size=\"small\" onClick={(e) => doneTask(e, task)}>Done</Button>\n              <Button size=\"small\" onClick={(e) => startTask(e, task)}>Start</Button>\n\n              <Dropdown  overlay={getMenu(task)}>\n                <a style={{ paddingLeft: 5 }} className=\"ant-dropdown-link\" onClick={e => e.preventDefault()}>\n                  {formartLevel(task.level)} <DownOutlined />\n                </a>\n              </Dropdown>\n              \n            </ButtonGroup>\n            {/* {task.id} */}\n            <DatePicker showTime defaultValue={getDeadlineTime(task)} onOk={value => onChooseDeadline(value, task)} size=\"small\" />\n            {getShowTips(task)}\n          </NoteItem>\n        )}\n      />\n    </Container2>\n  );\n}\n\ninterface NoteItemInputProps {\n  task: Task;\n}\n\nconst NoteItemInput: React.FC<NoteItemInputProps> = (props) => {\n  const [content, setContent] = useState(props.task.title)\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n\n  function saveTaskTitle(event: any) {\n    props.task.title = content\n    save()\n  }\n\n  return (\n    <Input style={{ background: \"#ffffff70\" }} value={content} onChange={(e) => setContent(e.target.value)} onBlur={saveTaskTitle} />\n  );\n}\n\nexport default TaskListContainer;"]},"metadata":{},"sourceType":"module"}