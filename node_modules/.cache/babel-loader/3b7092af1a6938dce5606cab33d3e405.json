{"ast":null,"code":"import _slicedToArray from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject4(){var data=_taggedTemplateLiteral([\"\\nmargin: 2px;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  flex-grow: 1;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  background: #ffffff;\\n  display: flex;\\n  height: 100%;\\n  flex-direction: column;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect}from'react';import styled from'styled-components';import{Input,message,Switch,Button,Modal,DatePicker}from'antd';import stores from'../stores';import TaskInfoFormat from'../utils/TaskInfoFormat';import Format from'../utils/Format';import{CurrentTaskKey}from'../stores/CurrentTaskStore';import'antd/dist/antd.css';import{CurrentDoingTaskKey}from'../stores/CurrentDoingTaskStore';import moment from'moment';var Container=styled.div(_templateObject());var Div=styled.div(_templateObject2());var Editor=styled(Input.TextArea)(_templateObject3());var ButtonGroup=styled(Button.Group)(_templateObject4());var ContentLayout=function ContentLayout(){var _ref=stores.useStore('mainmodel'),storeModel=_ref.storeModel;var _ref2=stores.useStore(CurrentTaskKey),currentTask=_ref2.currentTask;var _ref3=stores.useStore('mainmodel'),save=_ref3.save;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),content=_useState2[0],setContent=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),expectTime=_useState4[0],setExpectTime=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isPending=_useState6[0],setPendingUI=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),pendingReason=_useState8[0],setPendingReason=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),pendingTime=_useState10[0],setPendingTimeUI=_useState10[1];// toolsbar\nvar _ref4=stores.useStore(CurrentDoingTaskKey),currentDoingTask=_ref4.currentDoingTask,setCurrentDoingTask=_ref4.setCurrentDoingTask;/* ---------------------------初始化------------------------------- */ // 渲染当前note\nvar _useState11=useState(undefined),_useState12=_slicedToArray(_useState11,2),lastTask=_useState12[0],setLastTask=_useState12[1];useEffect(function(){// console.log(`Current content:${content}`)\nif(currentTask===undefined)return;if(!currentTask.isSameTask(lastTask)){// todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\nsetLastTask(currentTask);setContent(currentTask.note.content);// todo 这部分逻辑抽出去\nvar _expectTime=currentTask.getActualExpectConsume();if(_expectTime==-1){setExpectTime(_expectTime);}else{setExpectTime(_expectTime/(3600*1000));}setPendingUI(currentTask.isPending());setPendingReason(currentTask.pendingReason);setPendingTimeUI(getPendingDeadlineTime(currentTask));}});/* ----------------------------保存Note文本------------------------------ */function _onBlur(event){event.preventDefault();saveToLocal(event,false);}function saveToLocal(event,isManual){if(event)event.preventDefault();if(currentTask===undefined)return;currentTask.note.content=content;save();if(isManual)message.info(\"已保存\");}/* ------------------------------toolsbar---------------------------- */function deleteTask(event){if(currentTask===undefined)return;Modal.confirm({title:'确定要删除吗？',content:\"\\u662F\\u5426\\u5220\\u9664\\u4EFB\\u52A1\\uFF1A\".concat(currentTask.title),onOk:function onOk(){if(storeModel.removeTask(currentTask)){message.success(\"删除任务成功\");save();}else{message.error(\"删除任务失败\");}}});}function doneTask(event){if(currentTask===undefined)return;var task=currentTask;if(task.isDone()){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u5B8C\\u6210\\uFF0C\\u5B8C\\u6210\\u65F6\\u95F4:\".concat(Format.formatTimeInMs(task.doneTime)));return;}if(!task.isDoing()){Modal.confirm({title:'当前任务不在进行中，确定要完成吗？',content:\"\\u662F\\u5426\\u5B8C\\u6210\\u4EFB\\u52A1\\uFF1A\".concat(task.title),onOk:function onOk(){_realDone(task);}});return;}task.stop();setCurrentDoingTask(undefined);_realDone(task);}function _realDone(task){task.done();storeModel.orderTasks();message.success(\"任务已完成\");save();}function onChooseDeadline(value){if(currentTask===undefined)return;var task=currentTask;// 整了半天，原来直接 valueOf() 就行，百度了半天\n// if(value instanceof Moment){\n//   let moment:Moment = value\n//   console.log('onOk: ', moment.);\n// }\n// console.log('onOk: ', value.valueOf());\ntask.deadlines.push(value.valueOf());save();}function getDeadlineTime(){if(currentTask===undefined)return undefined;var task=currentTask;var deadline=task.getActualDeadline();if(deadline>0){return moment(deadline);}return undefined;}function getShowTips(){if(currentTask===undefined)return\"\";var task=currentTask;var result=\"  \"+TaskInfoFormat.getDoingStatusTips(task)+TaskInfoFormat.getConsumed(task)+TaskInfoFormat.getDeadline(task)+TaskInfoFormat.getConsumeExpected(task);return result;}function changeExceptTime(){if(currentTask===undefined)return;var task=currentTask;if(expectTime==-1){task.expectConsumes.push(-1);// todo 暂时不优化交互了，-1就是不设置时间\n}else{task.expectConsumes.push(expectTime*3600*1000);}}/* ---------------------------------------------------------- */function onChoosePendingDeadline(value){if(currentTask===undefined)return;var task=currentTask;if(!isPending){message.error(\"\\u8BBE\\u7F6E\\u65E0\\u6548\\uFF0C\\u8BF7\\u6253\\u5F00 pending \\u5F00\\u5173\\u540E\\u91CD\\u65B0\\u8BBE\\u7F6E\");return;}var pendingLine=value.valueOf();var deadline=task.getActualDeadline();if(deadline>0&&pendingLine>deadline){message.error(\"Pending\\u65F6\\u95F4(\".concat(Format.formatTimeInMinute(pendingLine),\")\\u665A\\u4E8EDeadline(\").concat(Format.formatTimeInMinute(deadline),\")\\uFF0C\\u8BF7\\u91CD\\u65B0\\u8BBE\\u7F6E\"));return;}task.pendingDeadline=pendingLine;setPendingTimeUI(getPendingDeadlineTime(task));save();}function getPendingDeadlineTime(task){var deadline=task.pendingDeadline;if(deadline>0){return moment(deadline);}return null;}function savePendingStatus(){if(currentTask===undefined)return;var task=currentTask;task.pendingReason=pendingReason;save();}function setPending(pendingStatus){if(currentTask===undefined)return;var task=currentTask;if(!pendingStatus){task.pendingDeadline=-1;}setPendingUI(pendingStatus);save();}/* ---------------------------------------------------------- */return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Div,null,/*#__PURE__*/React.createElement(ButtonGroup,null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return deleteTask(e);}},\"D\"),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return doneTask(e);}},\"Done\")),/*#__PURE__*/React.createElement(DatePicker,{showTime:true,defaultValue:getDeadlineTime(),onOk:function onOk(value){return onChooseDeadline(value);}}),getShowTips(),/*#__PURE__*/React.createElement(Input,{style:{width:'auto'},value:expectTime,placeholder:\"\\u82B1\\u8D39\\u65F6\\u95F4 \\u56DE\\u8F66\\u4FDD\\u5B58\",prefix:\"\\u9884\\u8BA1\",suffix:\"h\",onChange:function onChange(event){return setExpectTime(Number(event.target.value));},onPressEnter:changeExceptTime})),/*#__PURE__*/React.createElement(Div,null,/*#__PURE__*/React.createElement(Switch,{checkedChildren:\"Pending\",unCheckedChildren:\"No Pending\",checked:isPending,onChange:function onChange(event){return setPending(event);}}),/*#__PURE__*/React.createElement(DatePicker,{showTime:true,value:pendingTime,onOk:function onOk(value){return onChoosePendingDeadline(value);}}),/*#__PURE__*/React.createElement(Input,{style:{width:'auto'},value:pendingReason,prefix:\"\\u539F\\u56E0:\",placeholder:\"\\u81EA\\u52A8\\u4FDD\\u5B58\",onChange:function onChange(event){return setPendingReason(event.target.value);},onBlur:savePendingStatus})),/*#__PURE__*/React.createElement(Editor,{placeholder:\"\\u4EFB\\u52A1\\u65E5\\u5FD7\\uFF08\\u81EA\\u52A8\\u4FDD\\u5B58\\uFF09\",value:content,onChange:function onChange(event){return setContent(event.target.value);},onBlur:function onBlur(e){return _onBlur(e);}}));};export default ContentLayout;","map":{"version":3,"sources":["/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/ContentLayout.tsx"],"names":["React","useState","useEffect","styled","Input","message","Switch","Button","Modal","DatePicker","stores","TaskInfoFormat","Format","CurrentTaskKey","CurrentDoingTaskKey","moment","Container","div","Div","Editor","TextArea","ButtonGroup","Group","ContentLayout","useStore","storeModel","currentTask","save","content","setContent","expectTime","setExpectTime","isPending","setPendingUI","pendingReason","setPendingReason","pendingTime","setPendingTimeUI","currentDoingTask","setCurrentDoingTask","undefined","lastTask","setLastTask","isSameTask","note","getActualExpectConsume","getPendingDeadlineTime","onBlur","event","preventDefault","saveToLocal","isManual","info","deleteTask","confirm","title","onOk","removeTask","success","error","doneTask","task","isDone","formatTimeInMs","doneTime","isDoing","_realDone","stop","done","orderTasks","onChooseDeadline","value","deadlines","push","valueOf","getDeadlineTime","deadline","getActualDeadline","getShowTips","result","getDoingStatusTips","getConsumed","getDeadline","getConsumeExpected","changeExceptTime","expectConsumes","onChoosePendingDeadline","pendingLine","formatTimeInMinute","pendingDeadline","savePendingStatus","setPending","pendingStatus","e","width","Number","target"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Switch, Button, List, Dropdown, Menu, Modal, DatePicker } from 'antd';\nimport stores from '../stores';\nimport { Task } from '../model/model'\nimport { StoreModel, Duration } from '../model/model'\nimport Utils from '../utils/Utils'\nimport DateUtils from '../utils/DateUtils'\nimport TaskInfoFormat from '../utils/TaskInfoFormat'\nimport Format from '../utils/Format'\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport 'antd/dist/antd.css';\nimport { CurrentDoingTaskKey } from '../stores/CurrentDoingTaskStore';\nimport { ClickParam } from 'antd/lib/menu';\n// import { DateType } from 'antd/lib/date-picker';\nimport { DownOutlined } from '@ant-design/icons';\nimport moment from 'moment'\n\nconst Container = styled.div`\n  background: #ffffff;\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n`\n\nconst Div = styled.div`\n`\n\nconst Editor = styled(Input.TextArea)`\n  flex-grow: 1;\n`\n\nconst ButtonGroup = styled(Button.Group)`\nmargin: 2px;\n`\n\nconst ContentLayout: React.FC = () => {\n  const { storeModel } = stores.useStore('mainmodel') as { storeModel: StoreModel };\n  const { currentTask } = stores.useStore(CurrentTaskKey) as { currentTask: Task | undefined }\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n  const [content, setContent] = useState(\"\")\n  const [expectTime, setExpectTime] = useState(-1);\n\n  const [isPending, setPendingUI] = useState(false);\n  const [pendingReason, setPendingReason] = useState(\"\");\n  const [pendingTime, setPendingTimeUI] = useState<any>(null);\n\n\n  // toolsbar\n  const { currentDoingTask, setCurrentDoingTask } = stores.useStore(CurrentDoingTaskKey) as { currentDoingTask: Task | undefined, setCurrentDoingTask: (note: Task | undefined) => void }\n\n  /* ---------------------------初始化------------------------------- */\n\n  // 渲染当前note\n  const [lastTask, setLastTask] = useState<Task | undefined>(undefined)\n  useEffect(() => {\n    // console.log(`Current content:${content}`)\n    if (currentTask === undefined) return\n\n    if (!currentTask.isSameTask(lastTask)) {\n      // todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\n      setLastTask(currentTask)\n      setContent(currentTask.note.content)\n\n      // todo 这部分逻辑抽出去\n      const expectTime = currentTask.getActualExpectConsume()\n      if (expectTime == -1) {\n        setExpectTime(expectTime)\n      } else {\n        setExpectTime(expectTime / (3600 * 1000))\n      }\n\n      setPendingUI(currentTask.isPending())\n      setPendingReason(currentTask.pendingReason)\n      setPendingTimeUI(getPendingDeadlineTime(currentTask))\n    }\n  })\n\n  /* ----------------------------保存Note文本------------------------------ */\n\n  function onBlur(event: any) {\n    event.preventDefault();\n    saveToLocal(event, false)\n  }\n\n  function saveToLocal(event: any, isManual: boolean) {\n    if (event) event.preventDefault();\n    if (currentTask === undefined) return\n\n    currentTask.note.content = content\n    save()\n\n    if (isManual) message.info(\"已保存\")\n  }\n\n  /* ------------------------------toolsbar---------------------------- */\n\n  function deleteTask(event: any) {\n    if (currentTask === undefined) return\n\n    Modal.confirm({\n      title: '确定要删除吗？',\n      content: `是否删除任务：${currentTask.title}`,\n      onOk() {\n        if (storeModel.removeTask(currentTask)) {\n          message.success(\"删除任务成功\")\n          save()\n        } else {\n          message.error(\"删除任务失败\")\n        }\n      },\n    });\n  }\n\n  function doneTask(event: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (task.isDone()) {\n      message.error(`任务已完成，完成时间:${Format.formatTimeInMs(task.doneTime)}`)\n      return\n    }\n\n    if (!task.isDoing()) {\n      Modal.confirm({\n        title: '当前任务不在进行中，确定要完成吗？',\n        content: `是否完成任务：${task.title}`,\n        onOk() {\n          _realDone(task)\n        },\n      });\n      return\n    }\n\n    task.stop()\n    setCurrentDoingTask(undefined)\n    _realDone(task)\n  }\n\n  function _realDone(task: Task) {\n    task.done()\n    storeModel.orderTasks()\n    message.success(\"任务已完成\")\n    save()\n  }\n\n  function onChooseDeadline(value: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    // 整了半天，原来直接 valueOf() 就行，百度了半天\n    // if(value instanceof Moment){\n    //   let moment:Moment = value\n    //   console.log('onOk: ', moment.);\n    // }\n    // console.log('onOk: ', value.valueOf());\n\n    task.deadlines.push(value.valueOf())\n    save()\n  }\n\n  function getDeadlineTime(): any {\n    if (currentTask === undefined) return undefined\n    const task = currentTask\n\n    const deadline = task.getActualDeadline();\n    if (deadline > 0) {\n      return moment(deadline)\n    }\n\n    return undefined\n  }\n\n  function getShowTips(): string {\n    if (currentTask === undefined) return \"\"\n    const task = currentTask\n\n    let result = \"  \" + TaskInfoFormat.getDoingStatusTips(task) + TaskInfoFormat.getConsumed(task) + TaskInfoFormat.getDeadline(task)  + TaskInfoFormat.getConsumeExpected(task)\n    return result\n  }\n\n  function changeExceptTime() {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (expectTime == -1) {\n      task.expectConsumes.push(-1) // todo 暂时不优化交互了，-1就是不设置时间\n    } else {\n      task.expectConsumes.push(expectTime * 3600 * 1000)\n    }\n  }\n\n  /* ---------------------------------------------------------- */\n\n  function onChoosePendingDeadline(value: any) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (!isPending) {\n      message.error(`设置无效，请打开 pending 开关后重新设置`)\n      return\n    }\n\n    const pendingLine = value.valueOf()\n    const deadline = task.getActualDeadline()\n    if ( deadline> 0 && pendingLine > deadline) {\n      message.error(`Pending时间(${Format.formatTimeInMinute(pendingLine)})晚于Deadline(${Format.formatTimeInMinute(deadline)})，请重新设置`)\n      return\n    }\n\n    task.pendingDeadline = pendingLine\n    setPendingTimeUI(getPendingDeadlineTime(task))\n    save()\n  }\n\n  function getPendingDeadlineTime(task: Task): any {\n    const deadline = task.pendingDeadline\n\n    if (deadline > 0) {\n      return moment(deadline)\n    }\n\n    return null\n  }\n\n  function savePendingStatus() {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    task.pendingReason = pendingReason\n    save()\n  }\n\n  function setPending(pendingStatus: boolean) {\n    if (currentTask === undefined) return\n    const task = currentTask\n\n    if (!pendingStatus) {\n      task.pendingDeadline = -1\n    }\n    setPendingUI(pendingStatus)\n    save()\n  }\n\n  /* ---------------------------------------------------------- */\n\n  return (\n    <Container>\n      {/* todo 没有 currentTask 就不展示 */}\n\n      {/* 不加这个 div 会换行 */}\n      <Div>\n        <ButtonGroup>\n          {/* 点击整行就是查看且开始，view是只查看不开始。暂时用不着吧 */}\n          {/* <Button type=\"primary\" size=\"small\">view</Button> */}\n          <Button onClick={(e) => deleteTask(e)}>D</Button>\n          {/* <Button type=\"primary\" size=\"small\" onClick={(e) => startTask(e, task)}>Stop</Button> */}\n          <Button onClick={(e) => doneTask(e)}>Done</Button>\n\n        </ButtonGroup>\n\n        <DatePicker showTime defaultValue={getDeadlineTime()} onOk={value => onChooseDeadline(value)} />\n        {getShowTips()}\n\n        <Input style={{ width: 'auto' }} value={expectTime} placeholder=\"花费时间 回车保存\" prefix=\"预计\" suffix=\"h\" onChange={(event) => setExpectTime(Number(event.target.value))} onPressEnter={changeExceptTime} />\n      </Div>\n\n      <Div>\n        <Switch checkedChildren=\"Pending\" unCheckedChildren=\"No Pending\" checked={isPending} onChange={(event) => setPending(event)} />\n\n        <DatePicker showTime value={pendingTime} onOk={value => onChoosePendingDeadline(value)} />\n\n        <Input style={{ width: 'auto' }} value={pendingReason} prefix=\"原因:\" placeholder=\"自动保存\" onChange={(event) => setPendingReason(event.target.value)} onBlur={savePendingStatus} />\n      </Div>\n\n      <Editor\n        placeholder=\"任务日志（自动保存）\" value={content} onChange={(event) => setContent(event.target.value)} onBlur={(e) => onBlur(e)}\n      />\n    </Container>\n  );\n}\n\nexport default ContentLayout;"]},"metadata":{},"sourceType":"module"}