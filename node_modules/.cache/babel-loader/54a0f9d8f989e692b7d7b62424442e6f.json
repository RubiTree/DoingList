{"ast":null,"code":"import _slicedToArray from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n:hover{\\n\\t/* background-color:#b4e7fc; */\\n  background-color: \",\"\\n};\\nbackground-color: \",\";\\nopacity : \",\";;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\nmargin: 1%;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\nmargin: 1%;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  /* background: #d1d3a2; */\\n  /* background: #d1dfff; */\\n  background: #282c34;\\n  overflow:auto;\\n  /* height: 800px; */\\n  height: 85vh;\\n  margin-top:10px;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  /* background: #d1d3a2; */\\n  /* background: #d1dfff; */\\n  background: #282c34;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect}from'react';import styled from'styled-components';import{Input,message,Switch,Button,Row,Col,List,Dropdown,Menu,Modal}from'antd';// 这样居然真的行\n// import { DateType } from 'antd/lib/date-picker';\nimport{DownOutlined}from'@ant-design/icons';import stores from'../stores';import{StoreModel}from'../model/model';import Utils from'../utils/Utils';import DateUtils from'../utils/DateUtils';import TaskInfoFormat from'../utils/TaskInfoFormat';import Format from'../utils/Format';import{Task}from'../model/model';import{CurrentTaskKey}from'../stores/CurrentTaskStore';import{CurrentDoingTaskKey}from'../stores/CurrentDoingTaskStore';import{CurrentDayOffsetKey}from'../stores/CurrentDayOffsetStore';import'antd/dist/antd.css';import{plainToClass}from\"class-transformer\";var Container=styled.div(_templateObject());var Container2=styled.div(_templateObject2());var InputGroup=styled(Input.Group)(_templateObject3());var ButtonGroup=styled(Button.Group)(_templateObject4());var TaskListContainer=function TaskListContainer(){var _ref=stores.useStore('mainmodel'),storeModel=_ref.storeModel,save=_ref.save,setModel=_ref.setModel;var _ref2=stores.useStore(CurrentDayOffsetKey),currentDayOffset=_ref2.currentDayOffset,setCurrentDayOffset=_ref2.setCurrentDayOffset;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isNeedExceptTime=_useState4[0],setNeedExceptTime=_useState4[1];var _useState5=useState(2),_useState6=_slicedToArray(_useState5,2),expectTime=_useState6[0],setExpectTime=_useState6[1];// React.useEffect(() => {\n//   console.log(\"TaskListContainer useEffect\")\n// },[])\nfunction onAddNote(event){event.preventDefault();if(Utils.isStringEmpty(title)){message.error(\"请输入内容\");return;}var newTask=new Task();newTask.init(title);if(isNeedExceptTime){newTask.expectConsumes.push(expectTime*3600*1000);// 单位小时，转换\n}else{newTask.expectConsumes.push(-1);// 表示不设置时间\n}storeModel.addTask(newTask);storeModel.orderTasks();save();setTitle(\"\");}function changeOffsetDay(isAdd){if(isAdd){setCurrentDayOffset(currentDayOffset+1);}else{setCurrentDayOffset(currentDayOffset-1);}}function download(){Utils.downloadFile(\"DoingList_\".concat(Format.formatTimeInMsToFileName(Utils.getTimestamp()),\".dl\"),JSON.stringify(storeModel));}function upload(e){var file=e.target.files[0];console.log(file);var reader=new FileReader();reader.onload=function(){var uploadContent=this.result;if(typeof uploadContent==='string'){Modal.confirm({title:'确定要导入嘛？',content:\"\\u5BFC\\u5165\\u4F1A\\u8986\\u76D6\\u5F53\\u524D\\u6240\\u6709\\u4EFB\\u52A1\",onOk:function onOk(){Modal.confirm({title:'是否需要先下载当前任务？',content:\"\",onOk:function onOk(){download();setModel(plainToClass(StoreModel,JSON.parse(uploadContent)));},onCancel:function onCancel(){setModel(plainToClass(StoreModel,JSON.parse(uploadContent)));}});}});}else{message.error(\"导入文件有问题，导入失败\");}};//读取文件内容\nreader.readAsText(file);}function getOffsetString(){var base=\"\"+currentDayOffset;if(currentDayOffset>0){base=\"+\"+base;}return base;}function getAllTaskStatus(){var notDoneTasks=storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)).filter(function(task){return!task.isDone();});if(notDoneTasks.length===0){return\"\";}var consumeFormat=\"\";var consumes=notDoneTasks.map(function(task){var left=task.getLeftExpectConsumeTime();if(left<0)return 0;return left;}).reduce(function(a,b){return a+b;});// console.log(\"getAllTaskStatus\" + consumes)\nif(consumes>0){consumeFormat=\"\\uFF0C\\u603B\\u5269\\u4F59\\u9884\\u4F30\\u9700\\u8981\\u82B1\\u8D39\".concat(Format.formatDuration(consumes));}return\"\\u5171\".concat(notDoneTasks.length,\"\\u4E2A\\u4EFB\\u52A1\\u672A\\u5B8C\\u6210\").concat(consumeFormat);}return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(ButtonGroup,null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return changeOffsetDay(false);}},\"\\u2190\"),/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:\"#ffffff\",padding:4}},Format.formatTimeInDay(DateUtils.getMyCurrentDayStamp(currentDayOffset)),\"(\",getOffsetString(),\")\"),/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return changeOffsetDay(true);}},\"\\u2192\"),/*#__PURE__*/React.createElement(\"span\",{style:{paddingLeft:10}}),/*#__PURE__*/React.createElement(Button,{type:\"primary\",size:\"small\",onClick:function onClick(e){return download();}},\"\\u5BFC\\u51FA\"),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",id:\"upload-file\",multiple:true,onChange:function onChange(event){return upload(event);}})),/*#__PURE__*/React.createElement(Input.Group,{compact:true,style:{width:'96%',margin:'2%',backgroundColor:\"#ffffff\"}},/*#__PURE__*/React.createElement(Input,{style:{width:'60%'},placeholder:\"\\u8F93\\u5165\\u4EFB\\u52A1\\uFF0C\\u56DE\\u8F66\\u6DFB\\u52A0\",value:title,onChange:function onChange(event){return setTitle(event.target.value);},onPressEnter:onAddNote}),/*#__PURE__*/React.createElement(Switch,{checkedChildren:\"\\u4F30\\u65F6\",unCheckedChildren:\"\\u4E0D\\u4F30\\u65F6\",defaultChecked:isNeedExceptTime,onChange:function onChange(event){return setNeedExceptTime(event);}}),/*#__PURE__*/React.createElement(Input,{style:{width:'20%'},defaultValue:expectTime,placeholder:\"\\u82B1\\u8D39\\u65F6\\u95F4\",prefix:\"\\u9884\\u8BA1\",suffix:\"h\",onChange:function onChange(event){return setExpectTime(Number(event.target.value));},onPressEnter:onAddNote})),/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:\"#ffffff\",padding:4,margin:'2%'}},getAllTaskStatus()),/*#__PURE__*/React.createElement(NoteList,null));};var NoteItem=styled.div(_templateObject5(),function(props){if(props.choosed){return'#f5b52b';}else{return'#b4e7fc';}},function(props){if(props.choosed){return'#f5b52b';}else{return'#ffffff';}},function(props){if(props.isDone){return 0.15;}else{return 1;}});var NoteList=function NoteList(){var _ref3=stores.useStore('mainmodel'),storeModel=_ref3.storeModel;var _ref4=stores.useStore(CurrentTaskKey),currentTask=_ref4.currentTask,setCurrentTask=_ref4.setCurrentTask;var _ref5=stores.useStore(CurrentDoingTaskKey),currentDoingTask=_ref5.currentDoingTask,setCurrentDoingTask=_ref5.setCurrentDoingTask;var _ref6=stores.useStore('mainmodel'),save=_ref6.save;var _ref7=stores.useStore(CurrentDayOffsetKey),currentDayOffset=_ref7.currentDayOffset,setCurrentDayOffset=_ref7.setCurrentDayOffset;useEffect(function(){// console.log(\"NoteList useEffect\")\nif(currentDoingTask===undefined){var doingTasks=storeModel.tasks.filter(function(value){return value.isDoing();});if(doingTasks.length===0){return;}if(doingTasks.length>1){console.error(\"\\u6709 \".concat(doingTasks.length,\" \\u4E2A\\u4EFB\\u52A1\\u5728\\u8FD0\\u884C\\u4E2D\\uFF0C\\u81EA\\u52A8\\u5173\\u95ED\"));for(var i=1;i<doingTasks.length;i++){doingTasks[i].stop();}}setCurrentDoingTask(doingTasks[0]);}});function onChooseNote(event,note){event.preventDefault();setCurrentTask(note);}var onClickMenu=function onClickMenu(param,task){task.level=Number(param.key);storeModel.orderTasks();save();param.domEvent.preventDefault();// 怎么阻止对 parent 的点击事件\n// param.domEvent.stopPropagation()\n};function getMenu(task){return/*#__PURE__*/React.createElement(Menu,{onClick:function onClick(param){return onClickMenu(param,task);}},/*#__PURE__*/React.createElement(Menu.Item,{key:\"1\"},\"\\u4F18\\u5148\\u7EA7 1\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"2\"},\"\\u4F18\\u5148\\u7EA7 2\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"3\"},\"\\u4F18\\u5148\\u7EA7 3\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"4\"},\"\\u4F18\\u5148\\u7EA7 4\"),/*#__PURE__*/React.createElement(Menu.Item,{key:\"5\"},\"\\u4F18\\u5148\\u7EA7 5\"));}function startTask(event,task){if(task.isDone()){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u5B8C\\u6210\\uFF0C\\u5B8C\\u6210\\u65F6\\u95F4:\".concat(Format.formatTimeInMs(task.doneTime)));return;}if(currentDoingTask!=undefined&&currentDoingTask.id===task.id){message.error(\"\\u4EFB\\u52A1\\u5DF2\\u7ECF\\u5728\\u8FDB\\u884C\\u4E2D\\uFF0C\\u4E0A\\u6B21\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\".concat(Format.formatTimeInMs(task.lastStartTime())));return;}if(task.isDoing()){// todo 自动恢复\nmessage.error(\"\\u4EFB\\u52A1\\u5F02\\u5E38\\u4E2D\\u65AD\\uFF0C\\u91CD\\u65B0\\u5F00\\u59CB\\u3002\\u4E0A\\u6B21\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\".concat(Format.formatTimeInMs(task.lastStartTime())));}if(currentDoingTask!=undefined){currentDoingTask.stop();}task.start();setCurrentDoingTask(task);storeModel.orderTasks();save();}function formartLevel(level){switch(level){case 1:return\"❗\";case 2:return\"🎏\";case 3:return\"3️⃣\";case 4:return\"4️\";case 5:return\"5️\";default:return\"\";}}function getShowTips(task){var result=\"  \"+TaskInfoFormat.getDoingStatusTips(task)+TaskInfoFormat.getDeadline(task)+TaskInfoFormat.getConsumeExpected(task);return result;}return/*#__PURE__*/React.createElement(Container2,null,/*#__PURE__*/React.createElement(List,{size:\"small\",style:{backgroundColor:'white',margin:\"1%\"},bordered:true,dataSource:storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)),renderItem:function renderItem(task){return/*#__PURE__*/React.createElement(NoteItem,{choosed:task.isSameTask(currentTask),key:task.id,onClick:function onClick(e){return onChooseNote(e,task);},isDone:task.isDone()},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{flex:\"1 1 auto\"},/*#__PURE__*/React.createElement(NoteItemInput,{key:task.id,task:task})),/*#__PURE__*/React.createElement(Col,{flex:\"0 1 auto\"},getShowTips(task),/*#__PURE__*/React.createElement(Dropdown,{overlay:getMenu(task)},/*#__PURE__*/React.createElement(\"a\",{style:{paddingLeft:5},className:\"ant-dropdown-link\",onClick:function onClick(e){return e.preventDefault();}},formartLevel(task.level),\" \",/*#__PURE__*/React.createElement(DownOutlined,null))),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(e){return startTask(e,task);}},\"Start\"))));}}));};var NoteItemInput=function NoteItemInput(props){var _useState7=useState(props.task.title),_useState8=_slicedToArray(_useState7,2),content=_useState8[0],setContent=_useState8[1];var _ref8=stores.useStore('mainmodel'),save=_ref8.save;function saveTaskTitle(event){props.task.title=content;save();}return/*#__PURE__*/React.createElement(Input,{style:{background:\"#ffffff70\",fontWeight:\"bold\"},value:content,onChange:function onChange(e){return setContent(e.target.value);},onBlur:saveTaskTitle});};export default TaskListContainer;","map":{"version":3,"sources":["/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/TaskListContainer.tsx"],"names":["React","useState","useEffect","styled","Input","message","Switch","Button","Row","Col","List","Dropdown","Menu","Modal","DownOutlined","stores","StoreModel","Utils","DateUtils","TaskInfoFormat","Format","Task","CurrentTaskKey","CurrentDoingTaskKey","CurrentDayOffsetKey","plainToClass","Container","div","Container2","InputGroup","Group","ButtonGroup","TaskListContainer","useStore","storeModel","save","setModel","currentDayOffset","setCurrentDayOffset","title","setTitle","isNeedExceptTime","setNeedExceptTime","expectTime","setExpectTime","onAddNote","event","preventDefault","isStringEmpty","error","newTask","init","expectConsumes","push","addTask","orderTasks","changeOffsetDay","isAdd","download","downloadFile","formatTimeInMsToFileName","getTimestamp","JSON","stringify","upload","e","file","target","files","console","log","reader","FileReader","onload","uploadContent","result","confirm","content","onOk","parse","onCancel","readAsText","getOffsetString","base","getAllTaskStatus","notDoneTasks","getTasks","getMyCurrentDayDur","filter","task","isDone","length","consumeFormat","consumes","map","left","getLeftExpectConsumeTime","reduce","a","b","formatDuration","backgroundColor","padding","formatTimeInDay","getMyCurrentDayStamp","paddingLeft","width","margin","value","Number","NoteItem","props","choosed","NoteList","currentTask","setCurrentTask","currentDoingTask","setCurrentDoingTask","undefined","doingTasks","tasks","isDoing","i","stop","onChooseNote","note","onClickMenu","param","level","key","domEvent","getMenu","startTask","formatTimeInMs","doneTime","id","lastStartTime","start","formartLevel","getShowTips","getDoingStatusTips","getDeadline","getConsumeExpected","isSameTask","NoteItemInput","setContent","saveTaskTitle","background","fontWeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Switch, Button, Row, Col, List, Dropdown, Menu, Modal, DatePicker } from 'antd';\n// 这样居然真的行\nimport { ClickParam } from 'antd/lib/menu';\n// import { DateType } from 'antd/lib/date-picker';\nimport { DownOutlined } from '@ant-design/icons';\nimport stores from '../stores';\nimport { StoreModel, Duration } from '../model/model'\nimport Utils from '../utils/Utils'\nimport DateUtils from '../utils/DateUtils'\nimport TaskInfoFormat from '../utils/TaskInfoFormat'\nimport Format from '../utils/Format'\nimport { Task, Note } from '../model/model'\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport { CurrentDoingTaskKey } from '../stores/CurrentDoingTaskStore';\nimport { CurrentDayOffsetKey } from '../stores/CurrentDayOffsetStore';\nimport 'antd/dist/antd.css';\nimport { plainToClass } from \"class-transformer\";\n\nconst Container = styled.div`\n  /* background: #d1d3a2; */\n  /* background: #d1dfff; */\n  background: #282c34;\n`\n\nconst Container2 = styled.div`\n  /* background: #d1d3a2; */\n  /* background: #d1dfff; */\n  background: #282c34;\n  overflow:auto;\n  /* height: 800px; */\n  height: 85vh;\n  margin-top:10px;\n`\n\nconst InputGroup = styled(Input.Group)`\nmargin: 1%;\n`\nconst ButtonGroup = styled(Button.Group)`\nmargin: 1%;\n`\n\nconst TaskListContainer: React.FC = () => {\n  const { storeModel, save, setModel } = stores.useStore('mainmodel') as { storeModel: StoreModel, save: () => void, setModel: (storeModel: StoreModel) => void };\n  const { currentDayOffset, setCurrentDayOffset } = stores.useStore(CurrentDayOffsetKey) as { currentDayOffset: number, setCurrentDayOffset: (offset: number) => void }\n  const [title, setTitle] = useState(\"\");\n  const [isNeedExceptTime, setNeedExceptTime] = useState(true);\n  const [expectTime, setExpectTime] = useState(2);\n\n  // React.useEffect(() => {\n  //   console.log(\"TaskListContainer useEffect\")\n  // },[])\n\n  function onAddNote(event: any) {\n    event.preventDefault();\n\n    if (Utils.isStringEmpty(title)) {\n      message.error(\"请输入内容\")\n      return\n    }\n\n    const newTask = new Task()\n    newTask.init(title)\n\n    if (isNeedExceptTime) {\n      newTask.expectConsumes.push(expectTime * 3600 * 1000) // 单位小时，转换\n    } else {\n      newTask.expectConsumes.push(-1) // 表示不设置时间\n    }\n\n    storeModel.addTask(newTask)\n    storeModel.orderTasks()\n    save()\n\n    setTitle(\"\")\n  }\n\n  function changeOffsetDay(isAdd: boolean) {\n    if (isAdd) {\n      setCurrentDayOffset(currentDayOffset + 1)\n    } else {\n      setCurrentDayOffset(currentDayOffset - 1)\n    }\n  }\n\n  function download() {\n    Utils.downloadFile(`DoingList_${Format.formatTimeInMsToFileName(Utils.getTimestamp())}.dl`, JSON.stringify(storeModel))\n  }\n\n  function upload(e: any) {\n    let file = e.target.files[0];\n    console.log(file)\n\n    let reader = new FileReader();\n    reader.onload = function (this) {\n      let uploadContent = this.result\n      if (typeof uploadContent === 'string') {\n        Modal.confirm({\n          title: '确定要导入嘛？',\n          content: `导入会覆盖当前所有任务`,\n          onOk() {\n            Modal.confirm({\n              title: '是否需要先下载当前任务？',\n              content: ``,\n              onOk() {\n                download()\n                setModel(plainToClass(StoreModel, JSON.parse(uploadContent as string)))\n              },\n              onCancel() {\n                setModel(plainToClass(StoreModel, JSON.parse(uploadContent as string)))\n              }\n            });\n          },\n        })\n      } else {\n        message.error(\"导入文件有问题，导入失败\")\n      }\n    }\n    //读取文件内容\n    reader.readAsText(file);\n  }\n\n  function getOffsetString() {\n    let base = \"\" + currentDayOffset\n    if (currentDayOffset > 0) {\n      base = \"+\" + base\n    }\n    return base\n  }\n\n  function getAllTaskStatus(): string {\n    let notDoneTasks = storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset)).filter((task) => { return !task.isDone() })\n\n    if (notDoneTasks.length === 0) {\n      return \"\"\n    }\n\n    let consumeFormat = \"\"\n    let consumes: number = notDoneTasks.map((task) => {\n      let left = task.getLeftExpectConsumeTime()\n      if (left < 0) return 0\n      return left\n    }).reduce((a, b) => a + b)\n\n    // console.log(\"getAllTaskStatus\" + consumes)\n    if (consumes > 0) {\n      consumeFormat = `，总剩余预估需要花费${Format.formatDuration(consumes)}`\n    }\n\n    return `共${notDoneTasks.length}个任务未完成${consumeFormat}`\n  }\n\n  return (\n    <Container>\n\n      {/* todo 这个组件可以单独抽出去 */}\n      <ButtonGroup>\n        <Button type=\"primary\" size=\"small\" onClick={(e) => changeOffsetDay(false)}>←</Button>\n\n        {/* 这个取当前时间的操作简直无敌... 蠢 */}\n        {/* <DatePicker defaultValue={moment(moment().format(dateFormat), dateFormat)} format={dateFormat} /> */}\n\n        <span style={{ backgroundColor: \"#ffffff\", padding: 4 }} >\n          {Format.formatTimeInDay(DateUtils.getMyCurrentDayStamp(currentDayOffset))}({getOffsetString()})\n        </span>\n\n        <Button type=\"primary\" size=\"small\" onClick={(e) => changeOffsetDay(true)}>→</Button>\n        <span style={{ paddingLeft: 10 }} ></span>\n        <Button type=\"primary\" size=\"small\" onClick={(e) => download()}>导出</Button>\n        <input type=\"file\" id=\"upload-file\" multiple onChange={(event) => upload(event)} />\n        {/* <Button type=\"primary\" size=\"small\" onClick={(e) => download()}>导入</Button> */}\n      </ButtonGroup>\n\n      <Input.Group compact style={{ width: '96%', margin: '2%', backgroundColor: \"#ffffff\" }}>\n        <Input style={{ width: '60%' }} placeholder=\"输入任务，回车添加\" value={title} onChange={(event) => setTitle(event.target.value)} onPressEnter={onAddNote} />\n        <Switch checkedChildren=\"估时\" unCheckedChildren=\"不估时\" defaultChecked={isNeedExceptTime} onChange={(event) => setNeedExceptTime(event)} />\n        <Input style={{ width: '20%' }} defaultValue={expectTime} placeholder=\"花费时间\" prefix=\"预计\" suffix=\"h\" onChange={(event) => setExpectTime(Number(event.target.value))} onPressEnter={onAddNote} />\n      </Input.Group>\n\n\n\n      <span style={{ backgroundColor: \"#ffffff\", padding: 4, margin: '2%' }} >\n        {getAllTaskStatus()}\n      </span>\n\n      <NoteList />\n    </Container>\n  );\n}\n\n\nconst NoteItem = styled.div`\n:hover{\n\t/* background-color:#b4e7fc; */\n  background-color: ${(props: { choosed: boolean, isDone: boolean }) => {\n    if (props.choosed) {\n      return '#f5b52b'\n    } else {\n      return '#b4e7fc'\n    }\n  }\n  }\n};\nbackground-color: ${(props: { choosed: boolean, isDone: boolean }) => {\n    if (props.choosed) {\n      return '#f5b52b'\n    } else {\n      return '#ffffff'\n    }\n  }\n  };\nopacity : ${(props: { choosed: boolean, isDone: boolean }) => {\n    if (props.isDone) {\n      return 0.15\n    } else {\n      return 1\n    }\n  }\n  };;\n`\nconst NoteList: React.FC = () => {\n  const { storeModel } = stores.useStore('mainmodel') as { storeModel: StoreModel };\n  const { currentTask, setCurrentTask } = stores.useStore(CurrentTaskKey) as { currentTask: Task | undefined, setCurrentTask: (note: Task) => void }\n  const { currentDoingTask, setCurrentDoingTask } = stores.useStore(CurrentDoingTaskKey) as { currentDoingTask: Task | undefined, setCurrentDoingTask: (note: Task | undefined) => void }\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n  const { currentDayOffset, setCurrentDayOffset } = stores.useStore(CurrentDayOffsetKey) as { currentDayOffset: number, setCurrentDayOffset: (offset: number) => void }\n\n  useEffect(() => {\n    // console.log(\"NoteList useEffect\")\n\n    if (currentDoingTask === undefined) {\n      let doingTasks = storeModel.tasks.filter((value) => { return value.isDoing() })\n\n      if (doingTasks.length === 0) {\n        return\n      }\n\n      if (doingTasks.length > 1) {\n        console.error(`有 ${doingTasks.length} 个任务在运行中，自动关闭`)\n\n        for (let i = 1; i < doingTasks.length; i++) {\n          doingTasks[i].stop()\n        }\n      }\n\n      setCurrentDoingTask(doingTasks[0])\n    }\n  });\n\n  function onChooseNote(event: any, note: Task) {\n    event.preventDefault()\n    setCurrentTask(note)\n  }\n\n  const onClickMenu = (param: ClickParam, task: Task) => {\n    task.level = Number(param.key)\n\n    storeModel.orderTasks()\n    save()\n\n    param.domEvent.preventDefault()\n\n    // 怎么阻止对 parent 的点击事件\n    // param.domEvent.stopPropagation()\n  };\n\n  function getMenu(task: Task): React.ReactElement {\n    return (\n      <Menu onClick={(param) => onClickMenu(param, task)}>\n        <Menu.Item key=\"1\">优先级 1</Menu.Item>\n        <Menu.Item key=\"2\">优先级 2</Menu.Item>\n        <Menu.Item key=\"3\">优先级 3</Menu.Item>\n        <Menu.Item key=\"4\">优先级 4</Menu.Item>\n        <Menu.Item key=\"5\">优先级 5</Menu.Item>\n      </Menu>\n    )\n  }\n  \n  function startTask(event: any, task: Task) {\n    if (task.isDone()) {\n      message.error(`任务已完成，完成时间:${Format.formatTimeInMs(task.doneTime)}`)\n      return\n    }\n\n    if (currentDoingTask != undefined && currentDoingTask.id === task.id) {\n      message.error(`任务已经在进行中，上次开始时间：${Format.formatTimeInMs(task.lastStartTime())}`)\n      return\n    }\n\n    if (task.isDoing()) {\n      // todo 自动恢复\n      message.error(`任务异常中断，重新开始。上次开始时间：${Format.formatTimeInMs(task.lastStartTime())}`)\n    }\n\n    if (currentDoingTask != undefined) {\n      currentDoingTask.stop()\n    }\n\n    task.start()\n    setCurrentDoingTask(task)\n    storeModel.orderTasks()\n    save()\n  }\n\n\n  function formartLevel(level: number): string {\n    switch (level) {\n      case 1:\n        return \"❗\"\n      case 2:\n        return \"🎏\"\n      case 3:\n        return \"3️⃣\"\n      case 4:\n        return \"4️\"\n      case 5:\n        return \"5️\"\n      default:\n        return \"\"\n    }\n  }\n\n  function getShowTips(task: Task): string {\n    let result = \"  \" + TaskInfoFormat.getDoingStatusTips(task) + TaskInfoFormat.getDeadline(task) + TaskInfoFormat.getConsumeExpected(task)\n    return result\n  }\n\n  return (\n    <Container2>\n      <List\n        size=\"small\"\n        style={{ backgroundColor: 'white', margin: \"1%\" }}\n        bordered\n        dataSource={storeModel.getTasks(DateUtils.getMyCurrentDayDur(currentDayOffset))}\n        renderItem={task => (\n          <NoteItem choosed={task.isSameTask(currentTask)} key={task.id} onClick={(e) => onChooseNote(e, task)} isDone={task.isDone()}>\n\n            <Row>\n              <Col flex=\"1 1 auto\">\n                <NoteItemInput key={task.id} task={task} />\n              </Col>\n              <Col flex=\"0 1 auto\">\n\n                {getShowTips(task)}\n                <Dropdown overlay={getMenu(task)}>\n                  <a style={{ paddingLeft: 5 }} className=\"ant-dropdown-link\" onClick={e => e.preventDefault()}>\n                    {formartLevel(task.level)} <DownOutlined />\n                  </a>\n                </Dropdown>\n\n                <Button  onClick={(e) => startTask(e, task)}>Start</Button>\n\n              </Col>\n            </Row>\n\n          </NoteItem>\n        )}\n      />\n    </Container2>\n  );\n}\n\ninterface NoteItemInputProps {\n  task: Task;\n}\n\nconst NoteItemInput: React.FC<NoteItemInputProps> = (props) => {\n  const [content, setContent] = useState(props.task.title)\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n\n  function saveTaskTitle(event: any) {\n    props.task.title = content\n    save()\n  }\n\n  return (\n    <Input style={{ background: \"#ffffff70\", fontWeight: \"bold\" }} value={content} onChange={(e) => setContent(e.target.value)} onBlur={saveTaskTitle} />\n  );\n}\n\nexport default TaskListContainer;"]},"metadata":{},"sourceType":"module"}