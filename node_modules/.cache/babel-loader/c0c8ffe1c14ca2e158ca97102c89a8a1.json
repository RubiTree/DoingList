{"ast":null,"code":"var _jsxFileName = \"/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/ContentLayout.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Button } from 'antd';\nimport stores from '../stores';\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport 'antd/dist/antd.css';\nconst Container = styled.div`\n  background: #ffffff;\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n`;\nconst Editor = styled(Input.TextArea)`\n  flex-grow: 1;\n`;\nconst ButtonGroup = styled(Button.Group)`\nmargin: 2px;\n`;\n\nconst ContentLayout = () => {\n  const {\n    currentTask\n  } = stores.useStore(CurrentTaskKey);\n  const {\n    save\n  } = stores.useStore('mainmodel');\n  const [content, setContent] = useState(\"\");\n  /* ---------------------------初始化------------------------------- */\n  // 渲染当前note\n\n  const [lastTask, setLastTask] = useState(undefined);\n  useEffect(() => {\n    // console.log(`Current content:${content}`)\n    if (currentTask === undefined) return;\n\n    if (!currentTask.isSameTask(lastTask)) {\n      // todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\n      setLastTask(currentTask);\n      setContent(currentTask.note.content);\n    }\n  });\n  /* ----------------------------保存Note文本------------------------------ */\n\n  function onBlur(event) {\n    event.preventDefault();\n    saveToLocal(event, false);\n  }\n\n  function saveToLocal(event, isManual) {\n    if (event) event.preventDefault();\n    if (currentTask === undefined) return;\n    currentTask.note.content = content;\n    save();\n    if (isManual) message.info(\"已保存\");\n  }\n  /* ---------------------------------------------------------- */\n\n\n  function deleteTask(event) {\n    if (currentTask === undefined) return;\n    Modal.confirm({\n      title: '确定要删除吗？',\n      content: `是否删除任务：${currentTask.title}`,\n\n      onOk() {\n        if (storeModel.removeTask(currentTask)) {\n          message.success(\"删除任务成功\");\n          save();\n        } else {\n          message.error(\"删除任务失败\");\n        }\n      }\n\n    });\n  }\n  /* ---------------------------------------------------------- */\n\n\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: \"small\",\n    onClick: e => deleteTask(e, task),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 15\n    }\n  }, \"D\"), /*#__PURE__*/React.createElement(Button, {\n    size: \"small\",\n    onClick: e => doneTask(e, task),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 15\n    }\n  }, \"Done\"), /*#__PURE__*/React.createElement(Button, {\n    size: \"small\",\n    onClick: e => startTask(e, task),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 15\n    }\n  }, \"Start\"), /*#__PURE__*/React.createElement(Dropdown, {\n    overlay: getMenu(task),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    style: {\n      paddingLeft: 5\n    },\n    className: \"ant-dropdown-link\",\n    onClick: e => e.preventDefault(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 17\n    }\n  }, formartLevel(task.level), \" \", /*#__PURE__*/React.createElement(DownOutlined, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 46\n    }\n  })))), /*#__PURE__*/React.createElement(Editor, {\n    placeholder: \"\\u4EFB\\u52A1\\u65E5\\u5FD7\\uFF08\\u81EA\\u52A8\\u4FDD\\u5B58\\uFF09\",\n    value: content,\n    onChange: event => setContent(event.target.value),\n    onBlur: e => onBlur(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default ContentLayout;","map":{"version":3,"sources":["/Users/bear/Develop/vscode/self/study/study1/React/DoingList/doinglist2/src/layouts/ContentLayout.tsx"],"names":["React","useState","useEffect","styled","Input","message","Button","stores","CurrentTaskKey","Container","div","Editor","TextArea","ButtonGroup","Group","ContentLayout","currentTask","useStore","save","content","setContent","lastTask","setLastTask","undefined","isSameTask","note","onBlur","event","preventDefault","saveToLocal","isManual","info","deleteTask","Modal","confirm","title","onOk","storeModel","removeTask","success","error","e","task","doneTask","startTask","getMenu","paddingLeft","formartLevel","level","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { Input, message, Button } from 'antd';\nimport stores from '../stores';\nimport { Task } from '../model/model'\nimport { CurrentTaskKey } from '../stores/CurrentTaskStore';\nimport 'antd/dist/antd.css';\n\nconst Container = styled.div`\n  background: #ffffff;\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n`\n\nconst Editor = styled(Input.TextArea)`\n  flex-grow: 1;\n`\n\nconst ButtonGroup = styled(Button.Group)`\nmargin: 2px;\n`\n\nconst ContentLayout: React.FC = () => {\n  const { currentTask } = stores.useStore(CurrentTaskKey) as { currentTask: Task | undefined }\n  const { save } = stores.useStore('mainmodel') as { save: () => void };\n  const [content, setContent] = useState(\"\")\n\n  /* ---------------------------初始化------------------------------- */\n\n  // 渲染当前note\n  const [lastTask, setLastTask] = useState<Task | undefined>(undefined)\n  useEffect(() => {\n    // console.log(`Current content:${content}`)\n    if (currentTask === undefined) return\n\n    if (!currentTask.isSameTask(lastTask)) {\n      // todo 这里放同步应该不会有问题吧，最大的问题应该是前面切了note但没切content的时候进行保存...\n      setLastTask(currentTask)\n      setContent(currentTask.note.content)\n    }\n  })\n\n  /* ----------------------------保存Note文本------------------------------ */\n\n  function onBlur(event: any) {\n    event.preventDefault();\n    saveToLocal(event, false)\n  }\n\n  function saveToLocal(event: any, isManual: boolean) {\n    if (event) event.preventDefault();\n    if (currentTask === undefined) return\n    \n    currentTask.note.content = content\n    save()\n\n    if (isManual) message.info(\"已保存\")\n  }\n\n  /* ---------------------------------------------------------- */\n\n  function deleteTask(event: any) {\n    if (currentTask === undefined) return\n\n    Modal.confirm({\n      title: '确定要删除吗？',\n      content: `是否删除任务：${currentTask.title}`,\n      onOk() {\n        if (storeModel.removeTask(currentTask)) {\n          message.success(\"删除任务成功\")\n          save()\n        } else {\n          message.error(\"删除任务失败\")\n        }\n      },\n    });\n  }\n\n  /* ---------------------------------------------------------- */\n\n  return (\n    <Container>\n      <ButtonGroup>\n              {/* 点击整行就是查看且开始，view是只查看不开始。暂时用不着吧 */}\n              {/* <Button type=\"primary\" size=\"small\">view</Button> */}\n              <Button size=\"small\" onClick={(e) => deleteTask(e, task)}>D</Button>\n              {/* <Button type=\"primary\" size=\"small\" onClick={(e) => startTask(e, task)}>Stop</Button> */}\n              <Button size=\"small\" onClick={(e) => doneTask(e, task)}>Done</Button>\n              <Button size=\"small\" onClick={(e) => startTask(e, task)}>Start</Button>\n\n              <Dropdown  overlay={getMenu(task)}>\n                <a style={{ paddingLeft: 5 }} className=\"ant-dropdown-link\" onClick={e => e.preventDefault()}>\n                  {formartLevel(task.level)} <DownOutlined />\n                </a>\n              </Dropdown>\n              \n            </ButtonGroup>\n\n      <Editor\n        placeholder=\"任务日志（自动保存）\" value={content} onChange={(event) => setContent(event.target.value)} onBlur={(e) => onBlur(e)}\n      />\n    </Container>\n  );\n}\n\nexport default ContentLayout;"]},"metadata":{},"sourceType":"module"}